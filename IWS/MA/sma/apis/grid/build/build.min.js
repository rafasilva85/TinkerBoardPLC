!function(){function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return r(i||e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}return e}()({1:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i.CellRender=function(){function e(t){n(this,e),this._grid=t,this._dgrid=t.dgrid,this.label="",this.width=0}return r(e,[{key:"renderHeaderCell",value:function(e){return e.innerHTML=this.label.replace(/"/g,""),0===e.innerHTML.length?void this.grid.styleColumn(this.id,"display: none;"):($(e).css("width",this.width+"px"),void $(e).css("text-align","center"))}},{key:"_createInput",value:function(){var e=this,t=$("<input />");return t.attr("type","text"),t.on("dblclick keypress",function(t){if(e._grid.checkLevel()){var i=$(t.currentTarget);("keypress"!==t.type||13===t.which)&&(i.removeAttr("readonly"),i.select(),e._dgrid.edit(e._dgrid.cell(i[0].parentNode)))}}),t.on("change focusout",function(t){if(i&&i.attr&&""!==i.attr("readonly")){var i=$(t.currentTarget);i.attr("readonly",""),i.val(i.val()),e._dispachChanges(i,e._dgrid.cell(i[0].parentNode))}}),t}},{key:"_dispachChanges",value:function(e,t){t&&t.row&&(t.row.data[t.column.field]=e.val(),$(t.row.element).trigger("click"))}},{key:"_idRender",value:function(e,t,i){$(i).css("width",this._dgrid.cell(i).column.width+"px"),$(i).css("vertical-align","middle"),$(i).css("text-align","right"),$(i).css("background-color","#eeeeee"),$(i).html(t)}},{key:"_checkBoxRender",value:function(e,t,i){var n=this,r=$('<input type="checkbox" />'),s=this._dgrid.cell(i).column;return r.attr("checked",0===parseInt(t)?!1:!0),r.attr("disabled",!s.input),r.css("height","16px"),r.css("width","16px"),r.css("text-align",s.align),r.css("margin","0 0 0 0"),r.css("border-style","none"),r.css("background-color","transparent"),$(i).css("width",s.width+"px"),$(i).css("vertical-align","middle"),$(i).css("text-align",s.align),r.on("change",function(e){var t=$(e.currentTarget);t.val(t[0].checked===!0?1:0);var i=n._dgrid.cell(t[0].parentNode);n._grid.onDataChange({cell:i,value:e.currentTarget.value,type:"checkbox",currentTarget:e.currentTarget}),n._dispachChanges(t,i)}),r[0]}},{key:"_inputRender",value:function(e,t,i){var n=this._dgrid.cell(i).column,r=this._createInput(),s=t;if(s&&s.length>0)switch(n.type){case"text":case"time":case"date":case"dateTime":case"timeUTC":case"dateUTC":case"dateTimeUTC":s=t;break;case"numeric":r.attr("step","any"),s=parseFloat(t);break;default:return null}return r.addClass("input-sm"),r.attr("value",s),r.attr("readonly",""),r.attr("disabled",!n.input),r.css("text-align",n.align),r.css("border-style","none"),r.css("background-color","transparent"),r.css("padding","0 0 0 0"),r.css("width","100%"),$(i).css("width",n.width+"px"),$(i).css("vertical-align","middle"),$(i).css("text-align",n.align),r[0]}},{key:"getRender",value:function(e){switch(e){case"text":case"numeric":case"picture":case"time":case"date":case"dateTime":case"timeUTC":case"dateUTC":case"dateTimeUTC":return this._inputRender.bind(this);case"id":return this._idRender.bind(this);case"checkbox":return this._checkBoxRender.bind(this);default:return null}}}]),e}()},{}],2:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i.Columns=function(){function e(t){n(this,e),this._columns=[],this._doubleClickEvent=t,this._properties=["ColumnLabel","ColumnField","ColumnType","ColumnWidth","ColumnAlign","ColumnInput"],cwidget.on("ColumnsCount",this._createColumns.bind(this))}return r(e,[{key:"getColumn",value:function(e){return this._columns[e]}},{key:"columns",value:function(){return this._columns}},{key:"_createColumns",value:function(){var e=0,t=0;for(e=parseInt(cwidget.ColumnsCount),t=0;e>t;++t)this._createColumn(t);for(t=0;t<this._properties.length;++t)cwidget.on(this._properties[t],this._onColumnChange.bind(this))}},{key:"_createColumn",value:function(e){var t={label:"",_field:"",_type:"Text",width:100,align:"Left",_input:!1,editor:"text",editOn:this._doubleClickEvent,canEdit:function(){return!0},autoSave:!0,set input(e){this._input=1===parseInt(e)?!0:!1,this._input?this.canEdit=function(){return!0}:this.canEdit=function(){return!1}},get input(){return this._input},set type(e){switch(this._type=e.replace(/"/g,""),t.type){case"numeric":t.editor="number";break;case"picture":t.editor="image";break;case"checkbox":t.editor="",t.editOn="",t.canEdit=function(){return!1};break;default:t.editor="text"}},get type(){return this._type},set field(e){this._field=e.replace(/"/g,""),this._field.length||(this._field=this.label)},get field(){return this._field}};this._columns[e]=t}},{key:"_onColumnChange",value:function(e,t){var i=this.getColumn(t),n=e.replace("Column","");n=n[0].toLowerCase()+n.substring(1),i[n]=cwidget[e][t],(void 0===i.label||null===i.label||0===i.label.length)&&(i.width="0"),this._isChangedColumns=!0}},{key:"count",value:function(){return this._columns.length}},{key:"get",value:function(){return this._columns}},{key:"getIsChangedColumns",value:function(){return this._isChangedColumns}},{key:"setIsChangedColumns",value:function(e){this._isChangedColumns&&(this._isChangedColumns=e)}}]),e}()},{}],3:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Grid=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./Columns"),o=e("./CellRender"),a=i.Grid=function(){function e(t,i,r){n(this,e);var a=0,l=["HighlightColor","TextColor","OddLinesColor","EvenLinesColor","ShowIDColumn","AllowSorting","FontName","FontStyle","FontSizeInPoints","FontColor"];this._preventMoveInit=!1;var d=dojo.declare([t,i]);for(this._dgrid=new d({},"grid"),this._touchUtil=r,this._originalInsertRow=this._dgrid.insertRow.bind(this._dgrid),this._originalRenderRow=this._dgrid.renderRow.bind(this._dgrid),this._dgrid.insertRow=this._preTreatRow.bind(this),this._dgrid.renderRow=this._preRenderRow.bind(this),this._helper=new window.SmaCustomWidget.Helper,this._helper.addFindToArray(),a=0;a<l.length;++a)cwidget.on(l[a],this._scheduleUpdateGrid.bind(this));this.columns=new s.Columns(r.dbltap),cwidget.on("RowNumber",this._receiveRowNumber.bind(this)),cwidget.on("QueryResults",this._queryResults.bind(this)),cwidget.on("UpdateCurrent",this._selectedValueChange.bind(this)),this._cellRender=new o.CellRender(this),this._dgrid.on("dgrid-sort",this._onSort.bind(this)),this._dgrid.on("dgrid-datachange",this.onDataChange.bind(this)),this._dgrid.on("dgrid-editor-show",this._onEditorShow.bind(this)),this._dgrid.on("dgrid-editor-hide",this._onEditorHide.bind(this)),this._dgrid.startup(),this._gridData=[],this._onUpdateGridDataTimeout=null,setTimeout(this._preventMove.bind(this),100),this._selectedValues=[],this._rowNumber=1,cwidget.RowNumber=1,this._onSendDataTimeout=null,this._is_click_changed=!1,this._selectItem=null}return r(e,[{key:"_onSort",value:function(e){var t=this._dgrid.cell(e.target).column.type;if("checkbox"!==t||"picture"!==t){var i=e.sort[0];e.preventDefault(),this._dgrid._lastCollection.sort(function(e,n){var r=i.property,s=i.descending,o=e[r],a=n[r];switch(t){case"numeric":o=parseFloat(o),a=parseFloat(a);break;case"date":case"dateTime":case"dateUTC":case"dateTimeUTC":if(o=Date.parse(o),a=Date.parse(a),isNaN(o)&&isNaN(a))return 0;if(isNaN(o))return s?-1:1;if(isNaN(a))return s?1:-1;break;case"text":o=o.toLowerCase(),a=a.toLowerCase()}return o>a?s?1:-1:a>o?s?-1:1:0}),this._scheduleUpdateGridData(),this._dgrid.updateSortArrow(e.sort,!0),this._clearSelection();for(var n=0;n<this._columns.length;++n)this._selectedValues[n]="";cwidget.RowNumber=0,this.updateData(-1,this._selectedValues)}}},{key:"onDataChange",value:function(e){var t=this,i=e.cell.row,n=e.cell.column.type,r=(e.cell.column.field,parseInt(e.cell.column.id));if(this._is_click_changed!==!0){if(this._rowNumber!=parseInt(i.id)&&this._treatSelection({currentTarget:i.element}),null===e.value)return void(e.returnValue=!1);switch(n){case"numeric":if(isNaN(e.value))return void(e.returnValue=!1);break;case"time":case"timeUTC":if(!this._helper.isValidTime(e.value))return void(e.returnValue=!1);break;case"date":case"dateUTC":if(!this._helper.isValidDate(e.value))return void(e.returnValue=!1);break;case"dateTime":case"dateTimeUTC":if(!this._helper.isValidDateTime(e.value))return void(e.returnValue=!1)}if(this._showIdColumn&&(r-=1),this._selectItem={evt:e},"checkbox"!==e.type&&this._selectedValues.length<this._columns.length-1)return void(e.returnValue=!1);this._is_click_changed=!0,setTimeout(function(){t.updateData(r,t._selectedValues)},500)}}},{key:"_onEditorShow",value:function(e){var t=e.cell.row;this._rowNumber!=parseInt(t.id)&&this._treatSelection({currentTarget:t.element})}},{key:"_onEditorHide",value:function(e){}},{key:"_isDateTimeColumn",value:function(e){switch(e){case"time":case"date":case"dateTime":case"timeUTC":case"dateUTC":case"dateTimeUTC":return!0;default:return!1}}},{key:"_parseDateTimeColumn",value:function(e,t){var i=null;switch(e){case"time":i=this._helper.strToTime(t,!1);break;case"date":i=this._helper.strToDate(t,!1);break;case"dateTime":i=this._helper.strToDateTime(t,!1);break;case"timeUTC":i=this._helper.strToTime(t,!0);break;case"dateUTC":i=this._helper.strToDate(t,!0);break;case"dateTimeUTC":i=this._helper.strToDateTime(t,!0);break;default:i=t}return i}},{key:"_preventMove",value:function(){return this._preventMoveInit===!0?void console.warn("Prevent move is already initialized."):(this._preventMoveInit=!0,$(cwidget.parent).on("mousemove touchmove",function(e){e.preventDefault()}),$(".grid-container").on("mousemove touchmove",function(e){e.target===$(".grid-container")[0]&&e.preventDefault()}),void $(".grid").on("mousemove touchmove",function(e){e.target===$(".grid")[0]&&e.preventDefault()}))}},{key:"_scheduleUpdateGrid",value:function(){this._onUpdateGridTimeout&&(clearTimeout(this._onUpdateGridTimeout),this._onUpdateGridDataTimeout=null),this._onUpdateGridTimeout=setTimeout(this._executeUpdateGrid.bind(this),100)}},{key:"_executeUpdateGrid",value:function(){var e=this,t=0,i="0px";this._initColumns(),this._columns.forEach(function(i){t+=parseInt(i.width),i.renderCell=e._cellRender.getRender(i.type),i.renderHeaderCell=e._cellRender.renderHeaderCell,"id"!==i.type&&(i.sortable=cwidget.AllowSorting)}),$(this._dgrid.domNode).css("width",t+"px"),this._dgrid.set("columns",this._columns),this.updateStyleSheetLayout(),i=parseInt($(".dgrid-header-row").css("height"))+"px",$(".dgrid-scroller").css({top:"","margin-top":i,"margin-bottom":""}),$(".dgrid-header-row").css("right","0px"),$(".dgrid-header-scroll").css("height",""),setTimeout(this._checkHorizontalScrollBar.bind(this)),setTimeout(this._checkVerticalScrollBar.bind(this)),this._onUpdateGridTimeout=null}},{key:"_initColumns",value:function(){if(this._columns&&this._columns.length>0&&!this.columns.getIsChangedColumns())return!0;this.columns.setIsChangedColumns(!1);var e=this.columns.get(),t=null;if(0==e.length)return setInterval(this._initColumns.bind(this),1),!1;var i=0;for(this._columns=[];;){if(!e[i])break;this._columns.push(e[i]),i++}return t=this._columns.find(function(e){return"ID"===e.label?!0:void 0}),this._showIdColumn=parseInt(cwidget.ShowIDColumn),this._showIdColumn?t||this._columns.unshift({label:"ID",field:"MID",type:"id",width:"50",input:!1,sortable:!1}):t&&this._columns.shift(),!0}},{key:"_receiveRowNumber",value:function(){var e=parseInt(cwidget.RowNumber)-1,t=null;if(this._gridData){if(-1===e)return void this._treatSelection({currentTarget:null});e>=this._gridData.length&&(e=this._gridData.length-1,cwidget.RowNumber=this._gridData.length),t=this._dgrid.row(e),this._treatSelection({currentTarget:t.element,updateScrollPos:!0})}}},{key:"_selectedValueChange",value:function(){var e=cwidget.UpdateCurrent.row,t=cwidget.UpdateCurrent.value,i=cwidget.UpdateCurrent.column;if(!(void 0===this._rowNumber||this._rowNumber!=e||this._rowNumber<0)){this._selectedValues[i]=t,this._showIdColumn&&(i+=1);var n=this._columns[i];n&&(this._gridData[this._rowNumber][n.field]=t,this._scheduleUpdateGridData())}}},{key:"disable",value:function(){}},{key:"_queryResults",value:function(){var e=this,t=cwidget.QueryResults;this._gridData.length=0,this._initColumns(),t.rows.forEach(function(t,i){var n={_notSortedRowIndex:i},r=null;t.forEach(function(t,i){if(e._showIdColumn&&(i+=1),r=e._columns[i]){var s=r.field,o=r.type;if(!s)return;"checkbox"==o&&(isNaN(parseInt(t.value))?t.value=t.value?1:0:t.value=1==t.value?1:0),e._isDateTimeColumn(o)?n[s]=e._parseDateTimeColumn(o,t.value):n[s]=t.value}},e),e._gridData.push(n)}),this._scheduleUpdateGridData(),cwidget.NumberOfRows=this._gridData.length}},{key:"_scheduleUpdateGridData",value:function(){this._onUpdateGridDataTimeout&&clearTimeout(this._onUpdateGridDataTimeout),this._onUpdateGridDataTimeout=setTimeout(this._executeUpdateGridData.bind(this),100)}},{key:"_executeUpdateGridData",value:function(){var e=this._dgrid.bodyNode.scrollTop;this._dgrid.refresh(),this._dgrid.renderArray(this._gridData),this._onUpdateGridDataTimeout=null,this._setLastSelection(!0,e),this._receiveRowNumber()}},{key:"_setLastSelection",value:function(e,t){var i=0,n=0,r=0,s=0,o=this._dgrid.bodyNode.scrollTop,a=this._dgrid.bodyNode.clientHeight,l=o+a;"undefined"==typeof this._rowNumber||this._rowNumber<0||(this._lastSelection&&(i=this._lastSelection.offsetTop),this._lastSelection=this._dgrid.row(this._rowNumber).element,this._lastSelection&&(e&&!t&&(r=this._lastSelection.clientHeight,n=this._lastSelection.offsetTop,s=n+r,s>l&&this._dgrid.scrollTo({y:s-a}),o>n&&this._dgrid.scrollTo({y:n})),t&&this._dgrid.scrollTo({y:t}),$(this._lastSelection).css("background-color",this._helper.numToRGB(cwidget.HighlightColor)),$(this._lastSelection).css("color",this._helper.numToRGB(cwidget.TextColor))))}},{key:"_preTreatRow",value:function(e,t,i,n,r){return this._showIdColumn&&(e.MID=n+1),this._originalInsertRow(e,t,i,n,r)}},{key:"_preRenderRow",value:function(e,t){var i=this._originalRenderRow(e,t);return $(i).on("click",this._treatSelection.bind(this)),i}},{key:"_treatSelection",value:function(e){var t=this,i=null,n=null;return null!==this._onSendDataTimeout&&(clearTimeout(this._onSendDataTimeout),this._onSendDataTimeout=null),e.currentTarget?(i=this._dgrid.row(e.currentTarget),void(this._rowNumber==parseInt(i.id)&&parseInt(cwidget.RowNumber)==parseInt(i.id)&&this._selectedValues.length>0||(this._clearSelection(),this._rowNumber=parseInt(i.id),n=i.data,this._notSortedRowNumber=n._notSortedRowIndex,this._setLastSelection(!!e.updateScrollPos,null),this._onSendDataTimeout=setTimeout(function(){var e=!1,i=null,r=0;for(r=0;r<t._columns.length;++r){i=t._columns[r];var s=null,o=r;"MID"!=i.field?(t._showIdColumn&&e&&(o-=1),s=n[i.field],"checkbox"==i.type?isNaN(parseInt(s))?t._selectedValues[o]=s?"1":"0":t._selectedValues[o]=1==s?"1":"0":t._selectedValues[o]=s):e=!0}t._rowNumber<0||(cwidget.RowNumber=t._rowNumber+1,t.updateData(-1,t._selectedValues),t._onSendDataTimeout=null)},500)))):void this._clearSelection()}},{key:"_clearSelection",value:function(){this._rowNumber=-1,this._lastSelection&&($(this._lastSelection).css("background-color",""),$(this._lastSelection).css("color",""))}},{key:"updateStyleSheetLayout",value:function(){var e=$("#dynamic-style"),t="",i=this._helper.parseFontStyle(cwidget.FontStyle);t+=".dgrid .dgrid-row-odd{background-color: "+this._helper.numToRGB(cwidget.OddLinesColor)+";}",t+=".dgrid .dgrid-row-even{background-color:"+this._helper.numToRGB(cwidget.EvenLinesColor)+";}",t+=".dgrid {color: "+cwidget.FontColor+";}",t+=".dgrid {font-family: "+cwidget.FontName+";}",t+=".dgrid {font-style: "+i.fontStyle+";}",t+=".dgrid {font-weight: "+i.fontWeight+";}",t+=".dgrid {font-size: "+cwidget.FontSizeInPoints+"pt;}",t+=".input-sm {font-size: "+cwidget.FontSizeInPoints+"pt;}",t+=".input-sm {height: "+1.1*cwidget.FontSizeInPoints+"pt;}",e[0]&&(e[0].innerHTML=t,e.appendTo($("head")))}},{key:"_checkHorizontalScrollBar",value:function(){var e=$(".grid-container").get(0).scrollWidth>$(".grid-container").get(0).clientWidth;if(e===!0){var t=$("#grid").css("height");$("#grid").css("height",parseFloat(t)-20+"px")}}},{key:"_checkVerticalScrollBar",value:function(){var e="0px",t=$(".dgrid-content").get(0).scrollHeight>$(".dgrid-content").get(0).clientHeight;if(t===!0){var i=$("#grid").css("width");$("#grid").css("width",parseFloat(i)+15+"px"),$(".dgrid-header-row").css("right","15px"),e=parseInt($(".dgrid-header-row").css("height"))+"px",$(".dgrid-header-scroll").css("height",e)}}},{key:"revertData",value:function(){if(null!==this._selectItem){var e=this._selectItem.evt;if(null===e)throw new Error("Unknow event!");if("undefined"!=typeof e.type&&"checkbox"===e.type){var t=$(e.currentTarget);t[0].checked?t[0].checked=!1:t[0].checked=!0}else e.cell.element.firstChild.setAttribute("value",e.oldValue),e.cell.element.firstChild.value=e.oldValue,e.cell.row.data[e.cell.column._field]=e.oldValue,this._selectItem=null}}},{key:"updateData",value:function(e,t){var i=cwidget.getPropertyId("UpdateCurrent");if(null!=i){var n=cwidget.getPropertyId("QueryResults");if(null!=n){"undefined"!=typeof cwidget.ESign&&(cwidget.host.widget.esign=parseInt(cwidget.ESign));var r={screenId:cwidget.host.screenId,ownerId:i,dataSourceId:n,row:parseInt(this._notSortedRowNumber),column:parseInt(e),values:t},s=function(e){e.resultCode===cwidget._proxy.esign.credential_invalidSecurityLevel&&this.revertData()},o=1===cwidget.host.widget.esign&&this._is_click_changed===!0;0===cwidget.host.widget.esign||o?(this._is_click_changed=!1,cwidget.host.widget.checkESign("updateData",r,cwidget.host.widget.esign,{resultCallBack:s.bind(this),closeCallBack:this.revertData.bind(this)})):this._is_unclick_changed=!1}}}},{key:"checkLevel",value:function(){return 0===cwidget.Security||1===cwidget._proxy.securityLevels[cwidget.Security]}},{key:"dgrid",get:function(){return this._dgrid}}]),e}();window.__debug&&window.__debug(),new a(dojo.require("dgrid/Grid"),dojo.require("dgrid/Editor"),dojo.require("dgrid/util/touch"))},{"./CellRender":1,"./Columns":2}]},{},[3]);
//# sourceMappingURL=Z:/.helpers/tasks/../../dailybuilds/grid/grid/build/build.min.js.map