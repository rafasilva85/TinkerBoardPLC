!function(){function e(t,i,a){function o(s,l){if(!i[s]){if(!t[s]){var r="function"==typeof require&&require;if(!l&&r)return r(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){var i=t[s][1][e];return o(i||e)},h,h.exports,e,t,i,a)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}return e}()({1:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Axes=i.MAX=i.MIN=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=e("./Zoom"),s=e("./misc/Helper"),l=e("./misc/Enums"),r=e("./misc/ToolbarButton"),u=i.MIN=0,h=i.MAX=1;i.Axes=function(){function e(t){var i=this;a(this,e),this._ee=new EventEmitter,this._globals=t,this._helper=s.Helper.get(),this._duration=0,this._duration_isFloat=!1,this._periodType="",this._yMin=0,this._yMax=0,this._showVerticalGrid=!1,this._showHorizontalGrid=!1,this.isArchestrA=!1,this._isZoom=!1,this._globals.zoom.on("zoom-in",function(e){i.onZoomIn(e)}),this._globals.zoom.on("zoom-out",function(e){i.onZoomOut(e)}),this._globals.zoom.on("cancel-zoom",function(e){i.onCancelZoom(e)}),this._globals.zoom.on("auto-scale",function(e){i.onAutoScale(e)}),this._panAndZoom=this._globals.scope.options.d3PanAndZoom,this._panAndZoom.pan.onEndHandler=this.onGestureFinish.bind(this),this._panAndZoom.zoom.onEndHandler=this.onGestureFinish.bind(this),this._panAndZoom.zoom.onStartHandler=function(){i._globals.processingGesture=!0},this._panAndZoom.pan.onStartHandler=function(){i._globals.processingGesture=!0},this.x.minMax[0]=Date.now()-1e3*this._duration,this.x.minMax[1]=Date.now(),this._globals.generateXAxisData(this.x.minMax[0],this.x.minMax[1])}return o(e,[{key:"onZoomIn",value:function(e){var t=this.y.minMax[h]-this.y.minMax[u];if(t/=2,this.y.minMax[h]=t+t/2+this.y.minMax[u],this.y.minMax[u]=t-t/2+this.y.minMax[u],this._globals.running===!0&&this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.StartDateTime){var i=this.x.minMax[h],a=new Date(new Date(i).getTime()-this._calculateDuarationByZoomType()),o=this._globals.matchDateFormat(a.toLocaleDateString())+" "+this._globals.matcheTimeFormat(a.getHours())+":"+this._globals.matcheTimeFormat(a.getMinutes())+":"+this._globals.matcheTimeFormat(a.getSeconds())+"."+a.getMilliseconds();this._globals.scope.options.x.period.time=o}this._isZoom=!0,this._ee.emitEvent("duration- change",[{data:this._calculateDuarationByDataType(this._duration),origin:"server"}]),this._globals.generateYAxisData(this.y.minMax[u],this.y.minMax[h]),this._globals.redraw()}},{key:"onZoomOut",value:function(e){var t=this.y.minMax[h]-this.y.minMax[u];if(t/=2,this.y.minMax[h]=t+2*t+this.y.minMax[u],this.y.minMax[u]=t-2*t+this.y.minMax[u],this._globals.running===!0&&this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.StartDateTime){var i=this.x.minMax[h],a=new Date(new Date(i).getTime()-this._calculateDuarationByZoomType()),o=this._globals.matchDateFormat(a.toLocaleDateString())+" "+this._globals.matcheTimeFormat(a.getHours())+":"+this._globals.matcheTimeFormat(a.getMinutes())+":"+this._globals.matcheTimeFormat(a.getSeconds())+"."+a.getMilliseconds();this._globals.scope.options.x.period.time=o}this._isZoom=!0,this._globals.enableActiveUpdateTrigger=!1,this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(this._duration),origin:"server"}]),this._globals.generateYAxisData(this.y.minMax[u],this.y.minMax[h]),this._globals.redraw()}},{key:"onCancelZoom",value:function(e){var t=this.y.minMax[h]-this.y.minMax[u],i=this._yMax-this._yMin,a=t/i,o=this._duration,n=o/a;if(this._duration!==n)if(this._parseDuration(n,!1),this._globals.running===!0&&this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.StartDateTime){var s=this.x.minMax[h],r=new Date(new Date(s).getTime()-1e3*n),c=this._globals.matchDateFormat(r.toLocaleDateString())+" "+this._globals.matcheTimeFormat(r.getHours())+":"+this._globals.matcheTimeFormat(r.getMinutes())+":"+this._globals.matcheTimeFormat(r.getSeconds())+"."+r.getMilliseconds();this._globals.scope.options.x.period.time=c}else if(this._globals.running===!1){var g=this.x.minMax[h],p=new Date(g).getTime()-1e3*this._duration+(this._duration-n)/2*1e3,d=new Date(g).getTime()-(this._duration-n)/2*1e3;this._calculateZoomInStopStatus(p,d)}this.y.minMax.length=0,this.y.minMax.push(this._yMin),this.y.minMax.push(this._yMax),this._globals.generateYAxisData(this._yMin,this._yMax),this.calculateX(),this._globals.redraw(),this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(this._duration),origin:"server"}]),this._globals.redraw()}},{key:"onAutoScale",value:function(e){this._globals.initialized!==!1&&this._globals.autoScale.calculated!==!1&&(this.y.minMax[u]=this._globals.autoScale.min,this.y.minMax[h]=this._globals.autoScale.max,this._yMin=this._globals.autoScale.min,this._yMax=this._globals.autoScale.max,this._globals.generateYAxisData(this._yMin,this._yMax),this._globals.redraw())}},{key:"onGestureFinish",value:function(e,t){var i=0,a=0;if("string"==typeof e&&(e=new Date(e)),"string"==typeof t&&(t=new Date(t)),this._globals.onlineOnly!==!1||this._globals.waittingQueryResult!==!0){if(a=parseInt(Math.abs(t-e)/1e3),a!=this._duration&&this._parseDuration(a,!0),this.x.minMax.length=0,this._globals.zoom.ranges.length=0,this._globals.zoom.state=0,this._globals.zoom.type=n.EZoomType.NO_ZOOM,this._globals.running===!1)this.x.minMax.push(e),this.x.minMax.push(t);else{i=Date.now();var o=this.calculateDateRange(this._globals.scope.options.x.period.time);""!=o.StartDate&&(end=o.StartDate),""!=o.EndDate&&(i=o.EndDate),this.x.minMax.push(end),this.x.minMax.push(i)}this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(this._duration),origin:"server"}]),this._globals.generateXAxisData(this.x.minMax[u],this.x.minMax[h]),this._globals.processingGesture=!1}}},{key:"periodType",value:function(e){this._globals.scope.options.x.period.type=l.Enums.EnumPeriodType[e.value]}},{key:"duration",value:function t(e){var i=0,a=null,t=0,o=!1;if(0!==e.value.length){if(e.value.indexOf(":")<-1&&e.value.indexOf(".")>e.value.indexOf(":")&&(e.value=e.value.split(".")[0]),e.value.indexOf(".")>-1||-1===e.value.indexOf(":")){if(i=parseFloat(e.value),NaN===i||0>i)return;t=3600*i,o=!0}else e.value.indexOf(":")>=2&&(a=e.value.split(":"),t=0,a.length>=1&&(t+=3600*parseInt(a[0])),a.length>=2&&(t+=60*parseInt(a[1])),a.length>=3&&(t+=parseInt(a[2])));t!==this._duration&&(this._duration=t,this._globals.scope.options.x.period.duration=e.value,this._globals.scope.options.x.period.durationTime=this.calculateTime(e.value),this._duration_isFloat=o,this.calculateDateRange(this._globals.scope.options.x.period.time),this._globals.zoom.reset(),this._globals.zoom.xOrigin=this._duration,this._helper.parseDates(this._globals.scope),this._globals.generateXAxisData(this.x.minMax[u],this.x.minMax[h]),this._globals.redraw(),this._globals.enableActiveUpdateTrigger=!1,this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(this._duration),origin:"server"}]))}}},{key:"_calculateDuarationByDataType",value:function(e){var t=0;return t=this._duration_isFloat?(e/3600).toFixed(6):e}},{key:"_calculateDuarationByZoomType",value:function(){var e=this._globals.zoom,t=Math.abs(e.state),i=0;return this._duration_isFloat?e.type===n.EZoomType.NO_ZOOM||0===e.state?i=1e3*this._duration:e.state>0?i=this._duration/2*1e3:e.state<0&&(i=2*this._duration*1e3):e.type===n.EZoomType.NO_ZOOM||0===e.state?i=1e3*this._duration:e.state>0?i=this._duration/Math.pow(2,t)*1e3:e.state<0&&(i=this._duration*Math.pow(2,t)*1e3),i}},{key:"calculateDateRange",value:function(e){var t="",i="",a="";if(e&&""!=e&&"0"!=e&&""!=this._globals.scope.options.x.period.duration)switch(a=this._globals.scope.options.x.period.durationTime,e.indexOf(":")>0&&e.indexOf(".")>e.indexOf(":")&&(e=e.split(".")[0]),this._globals.scope.options.x.period.type){case l.Enums.EnumPeriodType.StartDateTime:t=new Date(e).getTime(),i=new Date(e).getTime()+1e3*a;break;case l.Enums.EnumPeriodType.BeforeNow:this._globals.scope.options.x.period.running===!0?(t=Date.now()-1e3*this.calculateTime(e)-1e3*a,i=Date.now()-1e3*this.calculateTime(e)):(""===this._globals.previousEndTime&&(this._globals.previousEndTime=Date.now()),t=new Date(this._globals.previousEndTime).getTime()-1e3*this.calculateTime(e)-1e3*a,i=new Date(this._globals.previousEndTime).getTime()-1e3*this.calculateTime(e));break;case l.Enums.EnumPeriodType.Auto:this._globals.scope.options.x.period.running===!0?(t=Date.now()-1e3*this.calculateTime(e)-1e3*a,i=Date.now()-1e3*this.calculateTime(e)):(t=new Date(e).getTime(),i=new Date(e).getTime()+1e3*a)}return isNaN(t)&&(t=""),isNaN(i)&&(i=""),""!==i&&""!==t&&(isNaN(new Date(i).getTime())||isNaN(new Date(t).getTime()))&&(t=Date.now(),i=Date.now()),""!=t&&(this.x.minMax[u]=t),""!=i&&(this.x.minMax[h]=i),{StartDate:t,EndDate:i}}},{key:"calculateTime",value:function(e){var t=0,i=null,a=0;if(e.indexOf(":")>=2&&e.indexOf(".")>e.indexOf(":")&&(e=e.split(".")[0]),e.indexOf(".")>-1||-1===e.indexOf(":")){if(t=parseFloat(e),NaN===t)return 0;a=3600*t}else e.indexOf(":")>=2&&(i=e.split(":"),a=0,i.length>=1&&(a+=3600*parseInt(i[0])),i.length>=2&&(a+=60*parseInt(i[1])),i.length>=3&&(a+=parseInt(i[2])));return a}},{key:"_calculateZoomInStopStatus",value:function(e,t){if(this._globals.running===!1){if(this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.StartDateTime||this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.Auto){var i=new Date(e),a=this._globals.matchDateFormat(i.toLocaleDateString())+" "+this._globals.matcheTimeFormat(i.getHours())+":"+this._globals.matcheTimeFormat(i.getMinutes())+":"+this._globals.matcheTimeFormat(i.getSeconds())+"."+i.getMilliseconds();this._globals.scope.options.x.period.time=a,this._isZoom===!0&&(this._isZoom=!1,this._ee.emitEvent("zoom-time-change",[{data:a,origin:"local"}]))}this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.BeforeNow&&(this._globals.previousEndTime=new Date(t))}}},{key:"calculateX",value:function(){var e=this.x.minMax[u],t=this.x.minMax[h],i=this._globals.zoom,a=0,o=0,n=0,s=null,r=Math.abs(i.state),c=!1;if(n=this._calculateDuarationByZoomType(),1e3*i.xOrigin!==n&&(i.xOrigin=n/1e3,this._parseDuration(i.xOrigin,!1)),s=r>1&&i.ranges.length>0?i.ranges[r-2]:{to:t,from:e},this._globals.running===!0){a=Date.now(),o=a-n;var g=this.calculateDateRange(this._globals.scope.options.x.period.time);""!=g.StartDate&&(o=g.StartDate),""!=g.EndDate&&(a=g.EndDate)}else if(s&&r>0){if(i.state>0){if(a=s.to-n/2,o=s.from+n/2,1e3>a-o)return;this._calculateZoomInStopStatus(o,a),c=!0}else i.state<0&&(a=s.to+n/4,o=s.from-n/4,this._calculateZoomInStopStatus(o,a),c=!0);i.ranges.push({to:a,from:o})}else o=e,a=t;if(o!==a&&((0>o||0>a)&&(o=Date.now(),a=Date.now()),this.x.minMax.length=0,this.x.minMax.push(o),this.x.minMax.push(a),this._globals.generateXAxisData(o,a)),this._globals.running===!1&&c===!1){var p=this._globals.scope.options.x.period.time,d=!0;this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.Auto&&(d=2===p.indexOf(":")?!1:!0),d===!0&&(this.calculateDateRange(p),this._globals.generateXAxisData(this.x.minMax[u],this.x.minMax[h]))}i.avoidZeroState=!1}},{key:"_parseDuration",value:function(e,t){var i=0,a=0,o=0,n=[];return this._duration_isFloat?void this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(e),origin:"local"}]):(i=parseInt(e/3600),a=parseInt(e%3600/60),o=parseInt(e%3600%60),t===!0&&(this._duration=e),n.push(this._helper.numToTimePart(i)),n.push(this._helper.numToTimePart(a)),n.push(this._helper.numToTimePart(o)),this._ee.emitEvent("duration-change",[{data:this._calculateDuarationByDataType(n.join(":")),origin:"local"}]),void(this._globals.zoom.avoidZeroState=!0))}},{key:"enableMultiSections",value:function(e){var t=this._globals.scope.options,i=this._globals.hasMultiScales?"MULTI":"SINGLE",a=null;t.y.type.value=e?"STACKED":i,a=this._helper.retrieveButton(this._globals.scope,r.EToolbarButtonType.MULTI_SECTIONS),a&&(a.state=e?1:0),this._globals.redraw()}},{key:"multiSections",value:function(e){this.enableMultiSections(0!==parseInt(e.value))}},{key:"_updatePeriodTimeBySDT",value:function(e){var t=!1;if(this._globals.readyToInitializedTimeTag===!1){if(this._globals.scope.options.x.period.time=e.value,this._globals.running===!0&&this._globals.writeItemList&&this._globals.writeItemList.length>0){for(var i=0;i<this._globals.writeItemList.length;i++){var a=this._globals.writeItemList[i];if(new Date(a).getTime()===new Date(e.value).getTime()){t=!0;break}}t===!0&&(this._globals.readyToInitializedTimeTag=!0,this._globals.readToStartQuery=!0)}if(this._globals.readyToInitializedTimeTag===!1)return}if(this._globals.readToStartQuery===!0)this._globals.readToStartQuery=!1,t=!1;else{for(var o=0;o<this._globals.writeItemList.length;o++){var n=this._globals.writeItemList[o];if(new Date(n).getTime()===new Date(e.value).getTime()){t=!0;break}}this._globals.writeItemList.length>5&&this._globals.writeItemList.splice(0,this._globals.writeItemList.length-5)}t||(this._globals.running===!0?this._globals.enableActiveUpdateTrigger=!1:this._globals.writeItemList.splice(0,this._globals.writeItemList.length-1),this._globals.scope.options.x.period.time=e.value,this._ee.emitEvent("time-change",[{data:e.value,origin:"server"}]))}},{key:"_updatePeriodTimeByTBN",value:function(e){return this._globals.readyToInitializedTimeTag===!1?void(this._globals.scope.options.x.period.time=e.value):(this._globals.scope.options.x.period.time=e.value,void this._ee.emitEvent("time-change",[{data:e.value,origin:"server"}]))}},{key:"_updatePeriodTimeByAuto",value:function(e){if(this._globals.readyToInitializedTimeTag===!1)return void(this._globals.scope.options.x.period.time=e.value);var t=e.value,i=!0;this._globals.running===!1?(this._globals.scope.options.x.period.time=e.value,this._ee.emitEvent("time-change",[{data:t,origin:"server"}])):(t.indexOf(":")>0&&t.indexOf(".")>t.indexOf(":")&&(i=!1,t="00:00:00"),this._globals.scope.options.x.period.time=t,i===!0&&this._ee.emitEvent("time-change",[{data:t,origin:"server"}]))}},{key:"time",value:function(e){if(this._globals.running!==!1||this._globals.readyToInitializedToolbar!==!1)switch(this._globals.scope.options.x.period.type){case l.Enums.EnumPeriodType.StartDateTime:this._updatePeriodTimeBySDT(e);break;case l.Enums.EnumPeriodType.BeforeNow:this._updatePeriodTimeByTBN(e);break;case l.Enums.EnumPeriodType.Auto:this._updatePeriodTimeByAuto(e)}}},{key:"yMin",value:function(e){this._yMin=parseFloat(e.value),this.y.minMax.length=0,this.y.minMax.push(this._yMin),this.y.minMax.push(this._yMax),this._globals.axes.yMin=this._yMin,this._globals.generateYAxisData(this.y.minMax[u],this.y.minMax[h]),this._globals.redraw()}},{key:"yMax",value:function(e){this._yMax=parseFloat(e.value),this.y.minMax.length=0,this.y.minMax.push(this._yMin),this.y.minMax.push(this._yMax),this._globals.axes.yMax=this._yMax,this._globals.generateYAxisData(this.y.minMax[u],this.y.minMax[h]),this._globals.redraw()}},{key:"on",value:function(e,t){this._ee.on(e,t)}},{key:"_showGridMode",value:function(e){var t=this._globals.scope.options.grid;this._showVerticalGrid&&this._showHorizontalGrid?(t.mode=0,t.visible=!0,t.style={stroke:e.value},t.showHorizontalLines=!0):this._showVerticalGrid?(t.mode=0,t.visible=!0,t.style={stroke:e.value},t.showHorizontalLines=!1):this._showHorizontalGrid?(t.mode=1,t.visible=!1,t.showHorizontalLines=!0,t.style={stroke:e.value}):(t.showHorizontalLines=!1,t.visible=!1),this._globals.redraw()}},{key:"xAxesGridColor",value:function(e){""!=e.value&&(this._showVerticalGrid=!0),this._showGridMode(e)}},{key:"yAxesGridColor",value:function(e){""!=e.value&&(this._showHorizontalGrid=!0),this._showGridMode(e)}},{key:"xAxisNumberOf",value:function(e){if(""!=e.value){var t=this._globals.scope.options;t.x.ticks.lableCount=e.value}}},{key:"xAxesDivision",value:function(e){if(""!=e.value){var t=this._globals.scope.options;t.x.ticks.maxAllowed=e.value,this.isArchestrA&&(t.x.ticks.lableCount=e.value)}}},{key:"yAxesDivision",value:function(e){if(""!=e.value){var t=this._globals.scope.options;t.y.ticks=e.value,t.grid.horizontalLines=new Array(parseFloat(e.value))}}},{key:"scooterColor",value:function(e){if(""!=e.value){var t=this._globals.scope.options.scooter;t.color=e.value}}},{key:"yAxisMultipleScales",value:function(e){if(""!=e.value){var t=this._globals.scope.options.canvas.multipleScales;t.visible="1"==e.value}}},{key:"y",get:function(){return this._globals.scope.options.y},set:function(e){this._globals.scope.options.y=e}},{key:"x",get:function(){return this._globals.scope.options.x},set:function(e){this._globals.scope.options.x=e}}]),e}()},{"./Zoom":5,"./misc/Enums":7,"./misc/Helper":9,"./misc/ToolbarButton":12}],2:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.Legend=function(){function e(t){a(this,e),this._globals=t,this._legend=this._globals.scope.options.legend}return o(e,[{key:"visible",value:function(e){this._legend.visible=0!==parseInt(e.value)?!0:!1,this._globals.redraw()}}]),e}()},{}],3:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Pens=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=e("./misc/Helper");i.Pens=function(){function e(t){var i=this;a(this,e),this._helper=n.Helper.get(),this._globals=t,this._idToPen={},this._pens=[],this._globals.hasMultiScales=!1,this._globals.zoom.on("auto-scale",function(e){i.onAutoScale(e)})}return o(e,[{key:"label",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];i.FQN=t+"."+e.value,i.TagName=e.value,this._globals.updateLegendValues(i),this._globals.redraw()}},{key:"color",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];i.Color=this._helper.numToRGB(e.value),this._globals.updateLegendValues(i),this._globals.redraw()}},{key:"_checkOnlinePen",value:function(e){for(var t=[],i=0;i<this._pens.length;i++){var a=this._pens[i];null===a.onlineOnly&&t.push(a)}return this._globals.onlineOnly===!1&&t.length===this._pens.length?!1:e.onlineOnly===!1?!1:(null===e.onlineOnly&&(e.onlineOnly=!0),!0)}},{key:"tagField",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];if(this._checkOnlinePen(i)!==!1&&this._globals.running!==!1&&(0!=this._globals.onlineOnly||this._globals.waittingQueryResult!==!0))if(0===i.values.length||i.values[i.values.length-1].FakeValue===!1){var a={DateTime:new Date(Date.now()).toISOString(),Value:parseFloat(e.value),OpcQuality:192,FakeValue:!1,FQN:i.FQN};i.values.push(a),this._globals.generateProcessValues(i.index,!0,a)}else{var o=i.values[i.values.length-1];o.DateTime=new Date(Date.now()).toISOString(),o.Value=parseFloat(e.value),o.FakeValue=!1,this._globals.generateProcessValues(i.index,!1,o)}}},{key:"hide",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];""!=e.value?i.visible=0===parseInt(e.value)?!0:!1:i.visible=!0,this._globals.updateLegendValues(i),this._calculateMultipleScalesForVisiblePen(this._pens),this._globals.redraw()}},{key:"minScale",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];return i._setScales.min=!0,e&&isNaN(e.value)!==!0?(0===e.value.length?i.EngUnitMin=0:i.EngUnitMin=parseFloat(e.value),this._globals.updateLegendValues(i),this._checkMultiScales(i),this._yAxesMultipleScalesWidth(this._pens),void this._globals.redraw()):(i.EngUnitMin=0,void this._checkMultiScales(i))}},{key:"maxScale",value:function(e){var t=e.propName.substr(-4,4),i=this._idToPen[t];return i._setScales.max=!0,e&&isNaN(e.value)!==!0?(0===e.value.length?i.EngUnitMax=0:i.EngUnitMax=parseFloat(e.value),this._globals.updateLegendValues(i),this._checkMultiScales(i),this._yAxesMultipleScalesWidth(this._pens),void this._globals.redraw()):(i.EngUnitMax=0,void this._checkMultiScales(i))}},{key:"removeUnused",value:function(e,t){var i=this,a=[];this._pens.forEach(function(o){for(o.values.forEach(function(i){var n=new Date(i.DateTime).getTime();o.onlineOnly===!0&&(t+=1e4),(e>=n+6e4||n>t)&&a.push(o)});a.length>0;)o.values.splice(a.pop(),1),i._globals.removeProcessValues(o.index,!1)})}},{key:"removeArchestrAUnused",value:function(e,t){var i=this,a=[];this._pens.forEach(function(o){if(o.values>2)for(o.values.forEach(function(i){var n=new Date(i.DateTime).getTime();(e>=n+6e4||n>t)&&a.push(o)});a.length>0;)o.values.splice(a.pop(),1),i._globals.removeProcessValues(o.index,!1)})}},{key:"_clearPen",value:function(e){this._idToPen[e].values.length=0,this._globals.removeProcessValues(this._idToPen[e].index,!0)}},{key:"clearValues",value:function(e){if(e)for(var t=0;t<e.length;t++)this._idToPen["000"+e[t].index].values.length=0,this._globals.removeProcessValues(e[t].index,!0);else for(var i in this._idToPen)this._clearPen(i)}},{key:"clearOnlieValues",value:function(){for(var e in this._idToPen){var t=this.getPen(e);t.onlineOnly===!0&&this._clearPen(e)}}},{key:"addNeedClearvalues",value:function(){this._pens.forEach(function(e){e._needClearValues=!0})}},{key:"getPen",value:function(e){return this._idToPen[this._helper.numToKey(e)]}},{key:"addPenValues",value:function(e,t){this._idToPen["000"+e].values.length=0,this._idToPen["000"+e].values=t}},{key:"addPen",value:function(e,t){t._setScales={min:!1,max:!1},this._idToPen[e]=t,this._pens.unshift(this._idToPen[e]),this._globals.generateInitialData(this._idToPen[e])}},{key:"addPoint",value:function(e,t){var i=null;i=this._idToPen[this._helper.numToKey(e)],i&&(t.FQN=i.FQN,t.TagName=i.FQN,i.values.push(t),this._globals.generateProcessValues(i.index,!0,t))}},{key:"addFakePoints",value:function(e){var t=this;this._pens.forEach(function(i){if(null!==i.onlineOnly&&i.onlineOnly!==!1&&(new Date(e).getTime()>new Date(Date.now()).getTime()&&(e=new Date(Date.now()).toISOString()),i.values.length>0)){var a=i.values[i.values.length-1];if(a.FakeValue===!0)a.DateTime=e,t._globals.generateProcessValues(i.index,!1,a);else{if(i.values.length>1&&new Date(i.values[i.values.length-1]).toLocaleString()>=new Date(e).toLocaleString())return;var o=JSON.parse(JSON.stringify(a));o.DateTime=e,o.FakeValue=!0,i.values.push(o),t._globals.generateProcessValues(i.index,!0,o)}}})}},{key:"onAutoScale",value:function(e){var t=this,i=!1,a=this._globals.scope.options;return this._pens.forEach(function(e){e.visible===!0&&(i=!0)}),i===!1?void(this._globals.autoScale.calculated=!1):(this._globals.autoScale.min=this._globals.getMAXNumber(),this._globals.autoScale.max=this._globals.getMINNumber(),this._pens.forEach(function(e){e.visible!==!1&&(e.EngUnitMin=t._globals.getMAXNumber(),e.EngUnitMax=t._globals.getMINNumber(),t._globals.hasMultiScales=!0,"SINGLE"===a.y.type.value&&(a.y.type.value="MULTI"),e.values.forEach(function(i){t._globals.autoScale.min=Math.min(t._globals.autoScale.min,i.Value),t._globals.autoScale.max=Math.max(t._globals.autoScale.max,i.Value),e.EngUnitMin=Math.min(e.EngUnitMin,i.Value),e.EngUnitMax=Math.max(e.EngUnitMax,i.Value)}),t._globals.generateYAxisDataByPen(e),t._globals.updateLegendValues(e))}),void(this._globals.autoScale.calculated=!0))}},{key:"_checkMultiScales",value:function(e){this._globals.hasMultiScales!==!0&&(this._globals.hasMultiScales=e._setScales.min===!0||e._setScales.max===!0)}},{key:"_yAxesMultipleScalesWidth",value:function(e){var t=this;e.forEach(function(e){e.OriEngUnitMin=e.EngUnitMin,e.OriEngUnitMax=e.EngUnitMax,""===e.EngUnitMin&&(e.EngUnitMin=0),""===e.EngUnitMax&&(e.EngUnitMax=100),e.EngUnitMin>=e.EngUnitMax&&(e.EngUnitMin=0,e.EngUnitMax=100),t._globals.updateLegendValues(e)}),this._calculateMultipleScalesForVisiblePen(e)}},{key:"_calculateMultipleScalesForVisiblePen",value:function(e){if(e.length>0){for(var t=[],i=0;i<e.length;i++){var a=e[i];a.visible&&t.push(a)}this._globals.scope.options.canvas.multipleScales.visiblePens=t,this._globals.scope.$apply()}}},{key:"_yTickWidth",value:function(e){for(var t=0,i=0;i<e.length;i++)t+="-"==e.charAt(i)?5:","==e.charAt(i)||"."==e.charAt(i)?3:7;return t}}]),e}()},{"./misc/Helper":9}],4:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Toolbar=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=e("./misc/ToolbarButton"),s=e("./misc/Helper"),l=e("./misc/Enums");i.Toolbar=function(){function e(t){a(this,e),this._ee=new EventEmitter,this._globals=t,this._toolbar=this._globals.scope.options.toolbar,this._scooter=this._globals.scope.options.scooter,this._gesture=this._globals.scope.options.d3PanAndZoom.gesture,this._helper=s.Helper.get(),this._enableToolbar=!1,this._checkRunStopChange=!1}return o(e,[{key:"visible",value:function(e){isNaN(e.value)!==!0&&(this._toolbar.visible=0!==parseInt(e.value)?!0:!1,this._globals.redraw())}},{key:"runStopVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.RUN_STOP),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.RUN_STOP,this._globals.running===!0?t.image="./img/icons/pause.svg":t.image="./img/icons/play.svg",t.state=this._globals.running===!1?0:1,t.events.click=this.runStop.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"periodVisible",value:function(e){}},{key:"cursorVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.CURSOR),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.CURSOR,this._globals.cursorVisible===!0?t.image="./img/icons/cursor_enabled.svg":t.image="./img/icons/cursor_desabled.svg",t.state=this._scooter.visible===!1?0:1,t.events.click=this.cursor.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"zoomInVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.ZOOM_IN),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.ZOOM_IN,t.image="./img/icons/zoom_in.svg",t.events.click=this.zoomIn.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"zoomOutVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.ZOOM_OUT),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.ZOOM_OUT,t.image="./img/icons/zoom_out.svg",t.events.click=this.zoomOut.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"cancelZoomVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.CANCEL_ZOOM),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.CANCEL_ZOOM,t.image="./img/icons/cancel_zoom.svg",t.events.click=this.cancelZoom.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"autoScaleVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.AUTO_SCALE),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.AUTO_SCALE,t.image="./img/icons/auto_scale.svg",t.events.click=this.autoScale.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"multiSectionsVisible",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.MULTI_SECTIONS),1!==parseInt(e.value)||t||(t=new n.ToolbarButton,t.id=n.EToolbarButtonType.MULTI_SECTIONS,t.image="./img/icons/multi_sections.svg",t.events.click=this.multiSections.bind(this),this._toolbar.buttons.push(t),this._globals.redraw())}},{key:"runStopTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.RUN_STOP),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"periodTooltip",value:function(e){}},{key:"cursorTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.CURSOR),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"zoomInTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.ZOOM_IN),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"zoomOutTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.ZOOM_OUT),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"cancelZoomTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.CANCEL_ZOOM),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"autoScaleTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.AUTO_SCALE),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"multiSectionsTooltip",value:function(e){var t=null;t=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.MULTI_SECTIONS),1!==parseInt(e.value)||t||(t.toolTip=e.value)}},{key:"_checkRunStopStatus",value:function(e){if(this._globals.enableHidden===!0){var t=1===parseInt(e)?!0:!1;this._globals.running!==t&&this._enableToolbar===!1?(this._enableToolbar=!0,this._ee.emitEvent("run-stop-change",[{data:this._globals.running===!0?1:0,origin:"toolbar"}])):this._globals.running===t&&(this._enableToolbar=!1,this._globals.initializedToolbarWhenEnableHide=!0)}}},{key:"_triggerCheckRunStopChange",value:function(){null!==this._intervalCheckRunStop&&(clearTimeout(this._intervalCheckRunStop),this._intervalCheckRunStop=null),this._intervalCheckRunStop=setTimeout(this._checkRunStopStatusChange.bind(this),2e3)}},{key:"_checkRunStopStatusChange",value:function(){this._globals.enableActiveUpdateTrigger===!1&&(this._globals.enableActiveUpdateTrigger=!0)}},{key:"runStop",value:function(e){var t=this,i=e&&e.events?"toolbar":"server",a=null;if(a="toolbar"===i?e:this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.RUN_STOP),!a)return this._globals.running=1===parseInt(e.value),this._gesture.horizontalPan.enable=!this._scooter.visible&&!this._globals.running,void(this._globals.scope.options.x.period.running=e.value);if(this._globals.enableHidden===!0&&this._globals.initializedToolbarWhenEnableHide===!1)return void this._checkRunStopStatus(e.value);"server"===i?a.state=parseInt(e.value):a.state=0===a.state?1:0;var o=1===a.state?!0:!1;this._globals.running!==o&&(this._checkRunStopChange=!0),0===a.state?a.image="./img/icons/play.svg":a.image="./img/icons/pause.svg",this._globals.running=1===a.state,this._globals.scope.options.x.period.running=this._globals.running,this._gesture.horizontalPan.enable=!this._scooter.visible&&!this._globals.running,"server"===i&&setTimeout(function(){return t._globals.scope.$digest()},0);var s=null,r=null,u=null;if(this._checkRunStopChange===!0)if(this._checkRunStopChange=!1,this._globals.running===!0)this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.StartDateTime&&""!==this._globals.scope.options.x.period.durationTime&&(s=this._globals.scope.options.x.period.durationTime,
r=new Date(Date.now()-1e3*s),u=this._globals.matchDateFormat(r.toLocaleDateString())+" "+this._globals.matcheTimeFormat(r.getHours())+":"+this._globals.matcheTimeFormat(r.getMinutes())+":"+this._globals.matcheTimeFormat(r.getSeconds())+"."+r.getMilliseconds(),this._globals.waittingQueryResult=!1,this._globals.scope.options.x.period.time=u,this._globals.enableActiveUpdateTrigger=!1,this._ee.emitEvent("time-change",[{data:u,origin:"local"}]),this._triggerCheckRunStopChange()),"00:00:00"===this._globals.scope.options.x.period.time||this._globals.scope.options.x.period.type!==l.Enums.EnumPeriodType.BeforeNow&&this._globals.scope.options.x.period.type!==l.Enums.EnumPeriodType.Auto||(this._globals.enableActiveUpdateTrigger=!1,this._ee.emitEvent("time-change",[{data:"00:00:00",origin:"local"}]),this._triggerCheckRunStopChange());else if(this._globals.enableActiveUpdateTrigger=!1,this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.BeforeNow&&(this._globals.previousEndTime=""),this._globals.scope.options.x.period.type===l.Enums.EnumPeriodType.Auto){if(this._globals.getMINDate()===this._globals.getMaxDate())return;r=this._globals.getMINDate(),u=null,r.indexOf(":")>0&&r.indexOf(".")>r.indexOf(":")&&(r=new Date(r),u=this._globals.matchDateFormat(r.toLocaleDateString())+" "+this._globals.matcheTimeFormat(r.getHours())+":"+this._globals.matcheTimeFormat(r.getMinutes())+":"+this._globals.matcheTimeFormat(r.getSeconds())+"."+r.getMilliseconds()),this._ee.emitEvent("time-change",[{data:u,origin:"local"}]),this._triggerCheckRunStopChange()}this._ee.emitEvent("run-stop-change",[{data:a.state,origin:i}]),this._globals.redraw()}},{key:"cursor",value:function(e){var t=this,i=e&&e.events?"toolbar":"server",a=null;return(a="toolbar"===i?e:this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.CURSOR))?("server"===i?a.state=parseInt(e.value):a.state=0===a.state?1:0,0===a.state?a.image="./img/icons/cursor_desabled.svg":a.image="./img/icons/cursor_enabled.svg",this._scooter.visible=1===a.state,"server"===i&&setTimeout(function(){return t._globals.scope.$digest()},0),this._gesture.horizontalPan.enable=!this._scooter.visible&&!this._globals.running,this._ee.emitEvent("cursor-change",[{data:a.state,origin:i}]),void this._globals.redraw()):(this._scooter.visible=0===parseInt(e.value)?!1:!0,void(this._gesture.horizontalPan.enable=!this._scooter.visible&&!this._globals.running))}},{key:"zoomIn",value:function(e){var t=e&&e.events?"toolbar":"server";this._globals.initialized!==!1&&("toolbar"===t&&(this._globals.enableZoomIn=!0),this._globals.zoom.dispatchZoomIn({data:e,origin:t}))}},{key:"zoomOut",value:function(e){var t=e&&e.events?"toolbar":"server";this._globals.initialized!==!1&&("toolbar"===t&&(this._globals.enableZoomOut=!0),this._globals.zoom.dispatchZoomOut({data:e,origin:t}))}},{key:"cancelZoom",value:function(e){var t=e&&e.events?"toolbar":"server";this._globals.initialized!==!1&&("toolbar"===t&&(this._globals.enableCancelZoom=!0),this._globals.zoom.dispatchCancelZoom({data:e,origin:t}))}},{key:"autoScale",value:function(e){var t=this,i=e&&e.events?"toolbar":"server",a=null;this._globals.initialized!==!1&&("toolbar"===i?(this._globals.enableAutoScale=!0,a=e):a=this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.AUTO_SCALE),"server"===i?(setTimeout(function(){return t._globals.scope.$digest()},0),null!==a&&(a.state=parseInt(e.value))):null!==a&&(a.state=0===a.state?1:0),this._globals.zoom.dispatchAutoScale({data:e,origin:i}))}},{key:"multiSections",value:function(e){var t=this,i=e&&e.events?"toolbar":"server",a=null;this._globals.initialized!==!1&&(a="toolbar"===i?e:this._helper.retrieveButton(this._globals.scope,n.EToolbarButtonType.MULTI_SECTIONS),"server"===i?(setTimeout(function(){return t._globals.scope.$digest()},0),null!==a&&(a.state=parseInt(e.value))):null!==a&&(a.state=0===a.state?1:0),this._ee.emitEvent("multi-sections-change",[{data:a.state,origin:i}]))}},{key:"on",value:function(e,t){this._ee.on(e,t)}}]),e}()},{"./misc/Enums":7,"./misc/Helper":9,"./misc/ToolbarButton":12}],5:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=(i.Zoom=function(){function e(){a(this,e),this.globals=null,this._ee=new EventEmitter,this.reset()}return o(e,[{key:"reset",value:function(){this.state=0,this.ranges=[],this.avoidZeroState=!1,this.type=n.NO_ZOOM,this.xOrigin=0}},{key:"dispatchZoomIn",value:function(e){if(this.globals.initialized!==!1){if(this.globals.enableZoomIn===!1)return void(this.globals.enableZoomIn=!0);for(this.state++;Math.abs(this.state)<this.ranges.length;)this.ranges.pop();this.type=n.ZOOM_IN,this.avoidZeroState=!0,this._ee.emitEvent("zoom-in",[e])}}},{key:"dispatchZoomOut",value:function(e){if(this.globals.initialized!==!1){if(this.globals.enableZoomOut===!1)return void(this.globals.enableZoomOut=!0);for(this.state--;Math.abs(this.state)<this.ranges.length;)this.ranges.pop();this.type=n.ZOOM_OUT,this.avoidZeroState=!0,this._ee.emitEvent("zoom-out",[e])}}},{key:"dispatchCancelZoom",value:function(e){if(this.globals.initialized!==!1){if(this.globals.enableCancelZoom===!1)return void(this.globals.enableCancelZoom=!0);this.ranges.length=0,this.state=0,this.type=n.NO_ZOOM,this.avoidZeroState=!1,this._ee.emitEvent("cancel-zoom",[e])}}},{key:"dispatchAutoScale",value:function(e){return this.globals.enableAutoScale===!1?void(this.globals.enableAutoScale=!0):void this._ee.emitEvent("auto-scale",[e])}},{key:"on",value:function(e,t){this._ee.on(e,t)}}]),e}(),i.EZoomType=function(){function e(){a(this,e)}return o(e,null,[{key:"NO_ZOOM",get:function(){return 0}},{key:"ZOOM_IN",get:function(){return 1}},{key:"ZOOM_OUT",get:function(){return 2}},{key:"ZOOM_CANCEL",get:function(){return 2}}]),e}())},{}],6:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.Data=function(){function e(t){a(this,e),this._globals=t,this._initScope()}return o(e,[{key:"_initScope",value:function(){this._globals.scope.languageResources={resourceData:null,data:null},this._globals.scope.data={bars:[],alarms:[],events:[],legend:[{base:{events:{},attrs:{pointshape:12,strokedasharray:0},styles:{},yIndex:void 0,isHighlight:!1,tagType:"",title:{}},values:[]}],zones:[],"process-values":[],"process-values-in-areas":[],"process-values-in-shapes":[],"process-values-limits":[],"process-values-in-ganttbars":[],x:[],y:[]},this._globals.scope.options={order:["canvas","legend","x","y","grid","toolbar","alarms","zones","process-values","events","scooter","d3PanAndZoom","process-values-in-shapes"],localization:{culture:"en-US",currentCultureShortDateFormat:"M/d/yyyy",currentCultureLongTimeFormat:"h:mm:ss tt",localizeDateTimeLabel:function(e){return e}},interactionEnabled:!1,progressIndicator:{hideOnRedraw:!0},toolbar:{grpName:"toolbar",elementType:"Toolbar",visible:!0,height:30,style:{},buttons:[]},canvas:{grpName:"canvas",elementType:"Canvas",margin:{top:8,left:60,bottom:60,right:30},multipleScales:{visible:!1,width:35,marginTop:10,marginBottom:10,visiblePens:[]}},legend:{elementType:"Legend",grpName:"legend",visible:!0},x:{grpName:"grp-x",elementType:"XAxis",type:{value:"SINGLE"},dates:{toStr:(new Date).toISOString(),fromStr:(new Date).toISOString()},period:{type:"",time:"",duration:"",durationTime:"",running:!0},dataType:1,visible:!0,hideLine:!1,labels:{angle:0,format:"%x , %X",dateTimeMultiline:!0},ticks:{maxAllowed:3,lableCount:3},minMax:[0,0],showDateFormat:!0,showLabelsInMultiLines:!0},y:{grpName:"y",elementType:"YAxis",title:"EngUnit",visible:!0,hideLine:!1,enableIndusoft:!0,minimumMarginForYAxisInteraction:0,autoScale:{value:!0,changeHandler:null},dates:null,type:{chart:"",tagType:"ANALOG",value:"STACKED",changeHandler:null},ticks:-1,minMax:[0,100],singleScaleForMutipleYAxis:!0,showChartTypeIsNotMixedAndYAxisIsStack:!0,showChartTypeIsMixedAndYAxisIsStack:!0,enableMultipleSection:!0,showExtentScale:!0},grid:{grpName:"gr",elementType:"Grid",visible:!0,style:{stroke:"#ddd"},mode:0,horizontalLines:[],showHorizontalLines:!1,enableBothOfGridLine:!0},alarms:{grpName:"alarms",elementType:"Bars",visible:!0},zones:{grpName:"zones",elementType:"Bands",visible:!0},events:{grpName:"ev",elementType:"Icons",visible:!0},"process-values":{grpName:"pv",elementType:"Lines",visible:!0,highlight:!0},"process-values-in-areas":{grpName:"area",elementType:"Areas",visible:!0,highlight:!0},"process-values-in-shapes":{grpName:"pvc",elementType:"Shapes",visible:!0},"process-values-limits":{grpName:"ll",elementType:"LimitLines",visible:!0,highlightLastPoint:!1},"process-values-in-ganttbars":{},scooter:{grpName:"scooter",elementType:"Scooter",visible:!0,alwaysVisible:!0},gesture:{horizontalPan:{enable:!0}},d3PanAndZoom:{grpName:"panandzoom",elementType:"PanAndZoom",visible:!0,gesture:{horizontalPan:{enable:!0}},pan:{enable:!0,enableOnDrag:!0,onStartHandler:null},zoom:{enable:!0},panZoomArea:{w:0,h:0},allowedTimeRange:[Number.MIN_VALUE,Number.MAX_VALUE],animationType:1,disablePanAndZoomControlsArea:!0,enableZoomIfDisableScooterAndEnableStopOrRunning:!0}}}}]),e}()},{}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=function(){};a.EnumPeriodType={Auto:0,StartDateTime:1,BeforeNow:2},i.Enums=a},{}],8:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.Globals=function(){function e(t,i,o,n,s,l){a(this,e),this.scope=t,this.interval=i,this.timeout=o,this.compile=n,this.running=s,this.cursoVisible=!1,this.waittingQueryResult=!1,this.zoom=l,this.chartArea=null,this.initialized=!1,this.processingGesture=!1,this.zoom.globals=this,this.onlineOnly=!1,this.hasMultiScales=!1,this.enableZoomIn=!0,this.enableZoomOut=!0,this.enableCancelZoom=!0,this.enableAutoScale=!0,this._redrawPending=!1,this._trendUpdateRate=1e3,this.updateTriggerByManually=!1,this.lastWriteTimeTag=null,this.enableActiveUpdateTrigger=!0,this.writeItemList=[],this.previousEndTime="",this.readyToInitializedTimeTag=!1,this.scope.initializeChartData=this.initializeChartData.bind(this),this.scope.redrawChart=this.redrawChart.bind(this),this.readToStartQuery=!1,this.readyToInitializedToolbar=!0,this.initializedToolbarWhenEnableHide=!1,this.enableHidden=!1,this.queryCounter=0,this.axes={yMin:0,yMax:100},this.autoScale={min:0,max:0,calculated:!1};try{var r=document.cookie.replace(/(?:(?:^|.*;\s*)_x_config\s*\=\s*([^;]*).*$)|^.*$/,"$1"),u=null;r&&(u=JSON.parse(unescape(r)),this._trendUpdateRate=u.trendUpdateRate)}catch(h){this._trendUpdateRate=1e3}setInterval(this.redraw.bind(this),this._trendUpdateRate,!0)}return o(e,[{key:"getMAXNumber",value:function(){return Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),Number.MAX_SAFE_INTEGER}},{key:"getMINNumber",value:function(){return Number.MIN_SAFE_INTEGER||(Number.MIN_SAFE_INTEGER=-9007199254740991),Number.MIN_SAFE_INTEGER}},{key:"redrawChart",value:function(){}},{key:"initializeChartData",value:function(){var e=function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}return"function"==typeof window.CustomEvent?!1:void(window.CustomEvent=e)};e()}},{key:"generateInitialData",value:function(e){this.scope.data.legend[0].values.push({attrs:{},events:{},rawData:{FQN:e.FQN,Source:"",Description:"",TagName:"",EngUnit:"",EngUnitMax:"",EngUnitMin:"",MessageOn:null,MessageOff:null,InterpolationType:e.InterpolationType,TagType:e.tagType,Visible:e.visible,color:"",receivedOn:0,values:[],Zone1_Type:"",Zone1_Value1:0,Zone1_Value2:0},styles:{},text:""});var t={base:{events:{},attrs:{pointshape:12,strokedasharray:0},isHighlight:!1,styles:{},tagType:"ANALOG",title:{text:""},validRange:!0,yIndex:void 0,visible:!0},values:[],tag:{}};this.scope.data.y.push(t);var i={base:{attrs:{stroke:"",opacity:"1"},events:{},InterpolationType:"LINEAR",isHighlight:!1,styles:{},tagType:"",title:{},yIndex:void 0,index:e.index,visible:!0},values:[]};this.scope.data["process-values"].push(i)}},{key:"updateLegendValues",value:function(e){var t=this,i=this.scope.data.legend[0].values;i.forEach(function(i,a){if(a===e.index){i.EngUnitMin=e.EngUnitMin,i.EngUnitMax=e.EngUnitMax,i.rawData.color=e.Color,i.rawData.TagName=e.TagName,i.styles={color:e.Color},i.text=e.TagName;var o=t.scope.data["process-values"][a];o.base.attrs.stroke=e.Color,o.base.visible=e.visible;var n=t.scope.data.y[a];n.base.styles={color:e.Color},n.base.visible=e.visible,n.tag={EngUnitMin:e.EngUnitMin,EngUnitMax:e.EngUnitMax}}})}},{key:"removeProcessValues",value:function(e,t){var i=this.scope.data["process-values"][e];t?i.values.length=0:i.values.splice(0,1)}},{key:"generateProcessValues",value:function(e,t,i){var a=this.scope.data["process-values"][e],o=void 0;t?(o={attrs:{},events:{},rawData:{name:i.FQN},styles:{},x:i.DateTime,y:i.Value},a.values.push(o)):(o=a.values[a.values.length-1],o.rawData={name:i.FQN},o.x=i.DateTime,o.y=i.Value)}},{key:"generateXAxisData",value:function(e,t){var i={base:{events:{},attrs:{pointshape:12,strokedasharray:0},styles:{},yIndex:void 0,isHighlight:!1,tagType:"DATETIME",title:{}},values:[]};this.scope.data.x.length=0,i.values.length=0,i.values.push(new Date(e).toISOString()),i.values.push(new Date(t).toISOString()),this.scope.data.x.push(i)}},{key:"generateYAxisData",value:function(e,t){this.scope.data.y.forEach(function(i){i.values.length=0,i.values.push(e,t)})}},{key:"generateYAxisDataByPen",value:function(e){this.scope.data.y.forEach(function(t,i){i===e.index&&(t.values.length=0,t.values.push(e.EngUnitMin,e.EngUnitMax))})}},{key:"getMaxDate",value:function(){return this.scope.data.x[0].values.length>1?this.scope.data.x[0].values[1]:void 0}},{key:"getMINDate",value:function(){return this.scope.data.x[0].values.length>0?this.scope.data.x[0].values[0]:void 0}},{key:"redraw",value:function(e){if(!e)return void(this._redrawPending=!0);if(this._redrawPending!==!1){try{this.scope.redrawChart&&this.scope.redrawChart(this.scope.options,this.scope.data)}catch(t){console.error(t)}this._redrawPending=!1,this.chartArea=this.scope.options.d3PanAndZoom.panZoomArea}}},{key:"loaderTrigger",value:function(){var e=null;e=$(".loader"),null!==e&&("none"!==e.css("display")?e.css("display","none"):e.css("display","block"))}},{key:"loaderShow",value:function(){var e=null;e=$(".loader"),null!==e&&e.css("display","block")}},{key:"loaderHide",value:function(){var e=null;e=$(".loader"),null!==e&&e.css("display","none")}},{key:"chartVisibility",value:function(e){var t=null;t=$(".chart-container"),null!==t&&t.css("visibility",e)}},{key:"matchDateFormat",value:function(e){for(var t=e.split("/"),i=0;i<t.length;i++)1===t[i].toString().length&&(t[i]="0"+t[i]);return t.join("/")}},{key:"matcheTimeFormat",value:function(e){return 1===e.toString().length?"0"+e.toString():e}}]),e}()},{}],9:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.Helper=function(e){function t(){return a(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return n(t,e),l(t,[{key:"parseDates",value:function(e){null!==e.options.x.dates&&this._setDate(e.options.x.dates),null!==e.options.y.dates&&this._setDate(e.options.y.dates)}},{key:"_setDate",value:function(e){"string"==typeof e.fromDate&&(e.toStr=toDate,e.fromStr=fromDate),"number"==typeof e.fromDate&&(e.toStr=new Date(toDate).toISOString(),e.fromStr=new Date(fromDate).toISOString()),"object"===s(e.fromDate)&&(e.toStr=toDate.toISOString(),e.fromStr=fromDate.toISOString())}},{key:"retrieveButton",value:function(e,t){var i=null;return e.options.toolbar.buttons.forEach(function(e){return e.id===t?void(i=e):void 0}),i}}],[{key:"get",value:function(){return this.helper||(this.helper=new t),this.helper}}]),t}(window.SmaCustomWidget.Helper)},{}],10:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.Module=function(){function e(t){a(this,e),this.sma_trend=angular.module("sma_trend",["ww","ngMaterial"]).config(["$mdThemingProvider",this.startModule]),this.sma_trend.controller("SmaTrendController",["$scope","$interval","$timeout","$compile",t.init.bind(t)]),angular.bootstrap(document.body,["sma_trend"])}return o(e,[{key:"startModule",value:function(e){e.definePalette("mcgpalette0",{50:"#ffffff",100:"#ffffff",200:"#ffffff",300:"#ffffff",400:"#ffffff",500:"#f3f3f5",600:"#e2e2e7",700:"#d2d2d9",800:"#c1c1cb",900:"#b0b0bd",A100:"#ffffff",A200:"#ffffff",A400:"#ffffff",A700:"#d2d2d9",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 400 500 600 700 800 900 A100 A200 A400 A700"}),e.definePalette("mcgpalette1",{50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 A100"}),e.theme("default").primaryPalette("mcgpalette0").accentPalette("mcgpalette1")}}]),e}()},{}],11:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.ProxyManager=function(){function e(t){a(this,e),this._proxy=window.SmaCustomWidget.proxy,this.trend=t,this._hasReceivedCount=!1,this._interval=null,this.trend.on("time-change",this.onAxesTimeChange.bind(this)),this.trend.axes.on("duration-change",this.onAxesDurationChange.bind(this)),this.trend.axes.on("zoom-time-change",this.onAxesTimeChange.bind(this)),this.trend.toolbar.on("time-change",this.onAxesTimeChange.bind(this)),this.trend.toolbar.on("run-stop-change",this.onToolbarRunStopChange.bind(this)),this.trend.toolbar.on("multi-sections-change",this.onToolbarMultiSectionsChange.bind(this)),this._proxy.autoResize=!1,this._proxy.addOnLoad(this._onLoad.bind(this)),this._proxy.addOnShow(this._onShow.bind(this)),this._proxy.addOnHide(this._onHide.bind(this)),this._host=this._proxy.host,this._proxy.registerTouchEvents&&this._proxy.registerTouchEvents(),this.EnumRuntimeScadaEngine={InduSoft:0,ArchestrA:1,ClearSCADA:2},this._proxy.ready=!0}return o(e,[{key:"setTrendQuery",value:function(e,t,i){this._host&&this._host.win&&this._host.win.services&&this._host.win.services.setTrendQuery(this._host.screenId,this._proxy.propertiesInfo.QueryResults.id,e,t,i)}},{key:"_onLoad",value:function(){this._proxy.on("PointsCount",this._proxyTreatPointsCount,this),this._proxy.on("ToolbarVisible",this.trend.toolbar.visible,this.trend.toolbar),this._proxy.on("ToolbarRunStopVisible",this.trend.toolbar.runStopVisible,this.trend.toolbar),this._proxy.on("ToolbarPeriodVisible",this.trend.toolbar.periodVisible,this.trend.toolbar),this._proxy.on("ToolbarCursorVisible",this.trend.toolbar.cursorVisible,this.trend.toolbar),this._proxy.on("ToolbarZoomInVisible",this.trend.toolbar.zoomInVisible,this.trend.toolbar),this._proxy.on("ToolbarZoomOutVisible",this.trend.toolbar.zoomOutVisible,this.trend.toolbar),this._proxy.on("ToolbarCancelZoomVisible",this.trend.toolbar.cancelZoomVisible,this.trend.toolbar),this._proxy.on("ToolbarAutoScaleVisible",this.trend.toolbar.autoScaleVisible,this.trend.toolbar),this._proxy.on("ToolbarMultiSectionsVisible",this.trend.toolbar.multiSectionsVisible,this.trend.toolbar),this._proxy.on("ToolbarRunStopTooltip",this.trend.toolbar.runStopTooltip,this.trend.toolbar),this._proxy.on("ToolbarPeriodTooltip",this.trend.toolbar.periodTooltip,this.trend.toolbar),this._proxy.on("ToolbarCursorTooltip",this.trend.toolbar.cursorTooltip,this.trend.toolbar),this._proxy.on("ToolbarZoomInTooltip",this.trend.toolbar.zoomInTooltip,this.trend.toolbar),this._proxy.on("ToolbarZoomOutTooltip",this.trend.toolbar.zoomOutTooltip,this.trend.toolbar),this._proxy.on("ToolbarCancelZoomTooltip",this.trend.toolbar.cancelZoomTooltip,this.trend.toolbar),this._proxy.on("ToolbarAutoScaleTooltip",this.trend.toolbar.autoScaleTooltip,this.trend.toolbar),this._proxy.on("ToolbarMultiSectionsTooltip",this.trend.toolbar.multiSectionsTooltip,this.trend.toolbar),this._proxy.on("ToolbarRunStop",this.trend.toolbar.runStop,this.trend.toolbar),this._proxy.on("ToolbarCursor",this.trend.toolbar.cursor,this.trend.toolbar),this._proxy.on("ToolbarZoomIn",this.trend.toolbar.zoomIn,this.trend.toolbar),this._proxy.on("ToolbarZoomOut",this.trend.toolbar.zoomOut,this.trend.toolbar),this._proxy.on("ToolbarCancelZoom",this.trend.toolbar.cancelZoom,this.trend.toolbar),this._proxy.on("ToolbarAutoScale",this.trend.toolbar.autoScale,this.trend.toolbar),this._proxy.on("ToolbarMultiSections",this.trend.toolbar.multiSections,this.trend.toolbar),this._proxy.on("LegendVisible",this.trend.legend.visible,this.trend.legend),this._proxy.on("PeriodType",this.trend.axes.periodType,this.trend.axes),this._proxy.on("AxesDuration",this.trend.axes.duration,this.trend.axes),this._proxy.on("AxesTime",this.trend.axes.time,this.trend.axes),this._proxy.on("AxesYMin",this.trend.axes.yMin,this.trend.axes),this._proxy.on("AxesYMax",this.trend.axes.yMax,this.trend.axes),this._proxy.on("AxesMultiSections",this.trend.axes.multiSections,this.trend.axes),this._proxy.on("AxesColor",this.trend.axes.xAxesGridColor,this.trend.axes),this._proxy.on("YAxisGridColor",this.trend.axes.yAxesGridColor,this.trend.axes),this._proxy.on("AxesGridDivision",this.trend.axes.xAxesDivision,this.trend.axes),this._proxy.on("YAxisGridDivision",this.trend.axes.yAxesDivision,this.trend.axes),this._proxy.on("AxesCursorCursorColor",this.trend.axes.scooterColor,this.trend.axes),this._proxy.on("EnableYAxisMultipleScales",this.trend.axes.yAxisMultipleScales,this.trend.axes),this._proxy.on("XAxisNumberOf",this.trend.axes.xAxisNumberOf,this.trend.axes),this._proxy.on("AdvancedUpdateTrigger",this.trend.updateTrigger,this.trend),this._proxy.on("QueryResults",this.trend.queryResults,this.trend)}},{key:"_proxyTreatPointsCount",value:function(e){var t=0,i="",a="";if(this._hasReceivedCount!==!0){this._hasReceivedCount=!0,t=parseInt(e.value);for(var o=0;t>o;o++)i=""+o,a="0000",a=a.substring(0,a.length-i.length)+i,this.trend.pens.addPen(a,{index:o,FQN:"",Source:"",Description:"",TagName:"",EngUnit:"",EngUnitMax:"",EngUnitMin:"",MessageOn:null,MessageOff:null,InterpolationType:"LINEAR",TagType:"ANALOG",visible:!0,color:"",receivedOn:0,onlineOnly:null,values:[],Zone1_Type:"",Zone1_Value1:0,Zone1_Value2:0}),this._proxy.on("PointLabel"+a,this.trend.pens.label,this.trend.pens),this._proxy.on("PointColor"+a,this.trend.pens.color,this.trend.pens),this._proxy.on("PointTagField"+a,this.trend.pens.tagField,this.trend.pens),this._proxy.on("PointHide"+a,this.trend.pens.hide,this.trend.pens),this._proxy.on("PointMinScale"+a,this.trend.pens.minScale,this.trend.pens),this._proxy.on("PointMaxScale"+a,this.trend.pens.maxScale,this.trend.pens)}}},{key:"_onShow",value:function(){this._proxy.host.widget.params&&this._proxy.host.widget.params._attr.engine===this.EnumRuntimeScadaEngine.ArchestrA?(this._interval=setInterval(this.trend.updateTrigger.bind(this.trend),1e3),this._proxy.host.widget.domNode.contentDocument.body&&this._proxy.host.widget.domNode.contentDocument.body.classList.add("ma_disable_native_touch")):this.trend.onShow()}},{key:"_onHide",value:function(){this._proxy.host.widget.params&&this._proxy.host.widget.params._attr.engine===this.EnumRuntimeScadaEngine.ArchestrA?(this._interval&&(clearInterval(this._interval),this._interval=null),this._proxy.host.widget.domNode.contentDocument.body&&this._proxy.host.widget.domNode.contentDocument.body.classList.remove("ma_disable_native_touch")):this.trend.onHide()}},{key:"onAxesTimeChange",value:function(e){"local"===e.origin&&this._proxy.set({propName:"AxesTime",value:e.data})}},{key:"onAxesDurationChange",value:function(e){"local"===e.origin&&this._proxy.set({propName:"AxesDuration",value:e.data})}},{key:"onToolbarRunStopChange",value:function(e){"server"!==e.origin&&this._proxy.set({propName:"ToolbarRunStop",value:e.data})}},{key:"onToolbarMultiSectionsChange",value:function(e){"server"!==e.origin&&this._proxy.set({propName:"ToolbarMultiSections",value:e.data})}}]),e}()},{}],12:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();i.ToolbarButton=function n(){a(this,n),this.id=-1,this.image=0,this.color="#000000",this.toolTip="",this.events={click:null},this.state=0},i.EToolbarButtonType=function(){function e(){a(this,e)}return o(e,null,[{key:"RUN_STOP",get:function(){return 0}},{key:"CURSOR",get:function(){return 1}},{key:"ZOOM_IN",get:function(){return 2}},{key:"ZOOM_OUT",get:function(){return 3}},{key:"CANCEL_ZOOM",get:function(){return 4}},{key:"AUTO_SCALE",get:function(){return 5}},{key:"MULTI_SECTIONS",get:function(){return 6}}]),e}()},{}],13:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Trend=void 0;var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=e("./misc/ProxyManager"),s=e("./misc/Data"),l=e("./misc/Module"),r=e("./misc/Globals"),u=e("./misc/Helper"),h=e("./misc/ToolbarButton"),c=e("./misc/Enums"),g=e("./Toolbar"),p=e("./Legend"),d=e("./Axes"),_=e("./Pens"),b=e("./Zoom"),m=i.Trend=function(){function e(){a(this,e),this._module=new l.Module(this),this._helper=u.Helper.get()}return o(e,[{key:"init",value:function(e,t,i,a){var o=this;this._globals=new r.Globals(e,t,i,a,!1,new b.Zoom),this._data=new s.Data(this._globals),this.toolbar=new g.Toolbar(this._globals),this.legend=new p.Legend(this._globals),this.pens=new _.Pens(this._globals),this.axes=new d.Axes(this._globals),this._ee=new EventEmitter,this._chart=null,this._timeOutStartQuery=null,this._isHidden=!1,this._lastUpdateTriggerTime=null,this._elapsedTime=null,this._initializedTrigger=!0,this._enableRunStopChange=!1,this._intervalDurationChange=null,this._intervalTimeChange=null,this._checkDurationChange=null,this._checkTimeChange=null,this._isQueryAll=!1,this._minPenIndex=0,this.axes.on("time-change",function(e){if("server"===e.origin){var t=!0;if(o._enableRunStopChange===!0){if(o._enableRunStopChange=!1,o._globals.scope.options.x.period.type===c.Enums.EnumPeriodType.Auto&&(t=!1,o._globals.running===!0)){var i=o._globals.scope.options.x.period.time;"00:00:00"===i&&(o.axes.calculateX(),o._queryFromDuration())}}else o.pens.clearOnlieValues();t&&(o.axes.calculateX(),o._intervalTimeChange||(o._intervalTimeChange=setInterval(o._checkQueryCounterAfterTimeChange.bind(o),100,o.axes.x.minMax)))}}),this.axes.on("duration-change",function(e){"server"===e.origin&&(o._globals.updateTriggerByManually===!0&&(o._globals.running===!0?o._updateTimeByPeriodInRunningStatus():o._updateTimeByPeriodInStopStatus()),o.pens.clearOnlieValues(),o.axes.calculateX(),o._intervalDurationChange||(o._intervalDurationChange=setInterval(o._checkQueryCounterAfterDurationChange.bind(o),100,o.axes.x.minMax)))}),this.toolbar.on("run-stop-change",function(e){"server"===e.origin&&((o._globals.running===!0||o._globals.scope.options.x.period.type===c.Enums.EnumPeriodType.Auto&&o._globals.running===!1)&&(o._enableRunStopChange=!0),o._globals.running===!0&&o._globals.scope.options.x.period.type===c.Enums.EnumPeriodType.BeforeNow&&(o._globals.enableActiveUpdateTrigger=!0))}),this.toolbar.on("multi-sections-change",function(e){isNaN(e.data)!==!0&&(o.axes.enableMultiSections(0!==parseInt(e.data)),o._globals.redraw())}),this._proxyManager=new n.ProxyManager(this)}},{key:"_checkQueryAllAfterDurationChange",value:function(){this._globals.enableActiveUpdateTrigger=!0,this._intervalDurationChange&&(clearInterval(this._intervalDurationChange),this._intervalDurationChange=null)}},{key:"_checkQueryAllAfterTimeChange",value:function(){this._globals.enableActiveUpdateTrigger=!0,this._intervalTimeChange&&(clearInterval(this._intervalTimeChange),this._intervalTimeChange=null)}},{key:"_checkQueryCounterAfterTimeChange",value:function(e){this._globals.queryCounter<=0&&(this._intervalTimeChange&&(clearInterval(this._intervalTimeChange),this._intervalTimeChange=null),this._isQueryAll===!1,this._startQueryFromDuration(e[0],e[1]),null!==this._checkTimeChange&&(clearTimeout(this._checkTimeChange),this._checkTimeChange=null),this._checkTimeChange=setTimeout(this._checkQueryAllAfterTimeChange.bind(this),4e3))}},{key:"_checkQueryCounterAfterDurationChange",value:function(e){this._globals.queryCounter<=0&&(this._intervalDurationChange&&(clearInterval(this._intervalDurationChange),this._intervalDurationChange=null),this._isQueryAll===!1,this._startQueryFromDuration(e[0],e[1]),null!==this._checkDurationChange&&(clearTimeout(this._checkDurationChange),this._checkDurationChange=null),this._checkDurationChange=setTimeout(this._checkQueryAllAfterDurationChange.bind(this),4e3))}},{key:"onShow",value:function(){this._globals.chartVisibility("visible"),this._globals.enableZoomIn=!1,this._globals.enableZoomOut=!1,this._globals.enableCancelZoom=!1,this._globals.enableAutoScale=!1,
this._isHidden===!0&&(this._globals.queryCounter=0,this._globals.writeItemList.length=0,this._globals.readyToInitializedTimeTag=!1,this._globals.readyToInitializedToolbar=!1,this._globals.initializedToolbarWhenEnableHide=!1,this._globals.running===!1&&this.pens.clearOnlieValues()),this._initializedTrigger=!0,this._startQuery()}},{key:"onHide",value:function(){this._isHidden=!0,this._globals.enableHidden=!0,this._globals.chartVisibility("hidden")}},{key:"_calculateElapsedTime",value:function(e){this._initializedTrigger!==!0||"0"!==e.value&&"1"!==e.value||(this._globals.updateTriggerByManually=!0,this._globals.enableActiveUpdateTrigger=!0),this._initializedTrigger=!1;var t=Date.now();null!=this._lastUpdateTriggerTime&&(this._elapsedTime=new Date(t).getTime()-new Date(this._lastUpdateTriggerTime).getTime()),this._lastUpdateTriggerTime=t}},{key:"_writeTimeToServer",value:function(e){this._ee.emitEvent("time-change",[{data:e,origin:"local"}]),this.axes.calculateDateRange(this._globals.scope.options.x.period.time),this._globals.generateXAxisData(this.axes.x.minMax[0],this.axes.x.minMax[1])}},{key:"_calculateStartTime",value:function(e){var t=this._globals.matchDateFormat(e.toLocaleDateString())+" "+this._globals.matcheTimeFormat(e.getHours())+":"+this._globals.matcheTimeFormat(e.getMinutes())+":"+this._globals.matcheTimeFormat(e.getSeconds())+"."+e.getMilliseconds();this._globals.scope.options.x.period.time=t,this._globals.writeItemList.push(t),this._writeTimeToServer(t)}},{key:"_updateTimeByPeriodInStopStatus",value:function(){if(this._globals.running!==!0)switch(this._globals.scope.options.x.period.type){case c.Enums.EnumPeriodType.StartDateTime:this._updateTimeBySDTPeriodInStopStatus();break;case c.Enums.EnumPeriodType.BeforeNow:this._updateTimeByTBNPeriodInStopStatus();break;case c.Enums.EnumPeriodType.Auto:this._updateTimeByAutoPeriodInStopStatus()}}},{key:"_updateTimeByPeriodInRunningStatus",value:function(){if(this._globals.running!==!1)switch(this._globals.scope.options.x.period.type){case c.Enums.EnumPeriodType.StartDateTime:this._updateTimeBySDTPeriod();break;case c.Enums.EnumPeriodType.Auto:case c.Enums.EnumPeriodType.BeforeNow:this._updateTimeByTBNPeriod()}}},{key:"_updateTimeByAutoPeriodInStopStatus",value:function(){this._updateTimeBySDTPeriodInStopStatus()}},{key:"_updateTimeByTBNPeriodInStopStatus",value:function(){return this._globals.enableHidden===!1&&""!==this._globals.scope.options.x.period.time?void(this._globals.readyToInitializedTimeTag=!0):void this._updateTimeByTBNPeriod()}},{key:"_updateTimeByTBNPeriod",value:function(){var e=null;if(this._globals.scope.options.x.period.durationTime){if(this._globals.readyToInitializedTimeTag===!1&&(this._globals.readyToInitializedTimeTag=!0,e="00:00:00"),null===e)return;this._globals.readyToInitializedToolbar===!1?(this._globals.running===!0?this._writeTimeToServer("00:00:00"):this._writeTimeToServer(this._globals.scope.options.x.period.time),this._globals.readyToInitializedToolbar=!0):this._writeTimeToServer(e)}}},{key:"_updateTimeBySDTPeriodInStopStatus",value:function(){this._globals.scope.options.x.period.durationTime&&this._globals.readyToInitializedTimeTag===!1&&(this._globals.readyToInitializedTimeTag=!0),this._globals.readyToInitializedToolbar===!1&&(this._writeTimeToServer(this._globals.scope.options.x.period.time),this._globals.readyToInitializedToolbar=!0)}},{key:"_updateTimeBySDTPeriod",value:function(){var e=null;if(this._globals.scope.options.x.period.durationTime){if(this._globals.readyToInitializedTimeTag===!1){var t=this._globals.scope.options.x.period.durationTime;e=new Date(Date.now()-1e3*t)}else{var i=this._globals.scope.options.x.period.time;e=new Date(new Date(i).getTime()+this._elapsedTime)}if(null===e)return;this._calculateStartTime(e)}}},{key:"_checkPenHasValue",value:function(){for(var e=!1,t=0;t<this.pens._pens.length;t++){var i=this.pens._pens[t];if(i.onlineOnly===!1&&0===i.values.length){e=!0;break}}return e}},{key:"updateTrigger",value:function(e){if(this._calculateElapsedTime(e),this._globals.readyToInitializedTimeTag!==!0||this._globals.enableActiveUpdateTrigger!==!1){var t=null,i=null;if(t=this._helper.retrieveButton(this._globals.scope,h.EToolbarButtonType.RUN_STOP),this.axes.calculateX(),t&&0===t.state)return this._updateTimeByPeriodInStopStatus(),void(this._checkPenHasValue()===!0&&this._startQuery());if(i=new Date(this.axes.x.minMax[d.MAX]).toISOString(),this.pens.addFakePoints(i),this._updateTimeByPeriodInRunningStatus(),this._globals.readyToInitializedTimeTag===!0&&this._queryFromDuration(),this._globals.processingGesture!==!1||1!=this._globals.onlineOnly&&this._globals.waittingQueryResult!==!1||(this._globals.redraw(),this._updateMultiScales()),this._proxyManager._host.widget.params&&this._proxyManager._host.widget.params._attr.engine===this._proxyManager.EnumRuntimeScadaEngine.ArchestrA)this.axes.isArchestrA=!0,this.pens.removeArchestrAUnused(this.axes.x.minMax[d.MIN],this.axes.x.minMax[d.MAX]);else{var a=this.axes.x.minMax[d.MIN],o=this.axes.x.minMax[d.MAX];this.pens.removeUnused(a,o)}}}},{key:"_queryFromDuration",value:function(){if(0!==this.pens._pens.length){var e=this.axes.x.minMax[d.MIN],t=this.axes.x.minMax[d.MAX],i=this._calculatePenPointTime(!0),a=this._calculatePenPointTime(!1);a>e&&t>i&&(e=a),e>t||this._startQueryFromDuration(e,t)}}},{key:"_calculatePenPointTime",value:function(e){var t=null;return this.pens._pens.forEach(function(i){if(0!==i.values.length&&i.onlineOnly!==!0){var a=null;a=e?new Date(i.values[0].DateTime).getTime():new Date(i.values[i.values.length-1].DateTime).getTime(),(null===t||t>a)&&(t=a)}}),t}},{key:"_redrawPen",value:function(e){var t=this;if(this._globals.readyToInitializedTimeTag!==!1){var i=this.pens.getPen(e.value.indexes[0].index);if(i.onlineOnly=!1,0!==e.value.rows.length){var a=null;i.values.length>0&&(a=new Date(i.values[i.values.length-1].DateTime).getTime());var o=null;e.value.rows.forEach(function(i,n){n>0||i.forEach(function(i,n){0===n&&(o=1e3*(parseInt(i.value)+e.value.startTicks),o<=t.axes.x.minMax[d.MIN]&&(a=null,t._isQueryAll=!0))})}),(null===a||this.pens._pens.length>e.value.indexes[0].index&&i._needClearValues===!0)&&(i._needClearValues===!0&&(i._needClearValues=!1,a=null),this.pens.clearValues(e.value.indexes)),(null===a||a>this.axes.x.minMax[d.MAX])&&(a=this.axes.x.minMax[d.MAX]),this._addExistedPenValue(i,this.axes.x.minMax[d.MIN],a),this._addNewPenValue(e,!0),this._globals.enableActiveUpdateTrigger===!1&&this._isQueryAll===!0&&(this._globals.enableActiveUpdateTrigger=!0)}}}},{key:"_addNewPenValue",value:function(e,t){var i=this,a=null,o=this.axes.x.minMax[d.MIN],n=this.axes.x.minMax[d.MAX];e.value.rows.forEach(function(t){t.forEach(function(t,s){if(0===s){if(!t.value||0===t.value.length)return;a=1e3*(parseInt(t.value)+e.value.startTicks),a=new Date(a).toISOString()}else{if(new Date(a).getTime()<o||new Date(a).getTime()>n)return;var l=s-1;e.value.indexes&&e.value.indexes[s-1].index&&(l=e.value.indexes[s-1].index);for(var r=[],u=i.pens.getPen(l).values,h=0;h<u.length;h++){var c=u[h];new Date(c.DateTime).getTime()===new Date(a).getTime()&&r.push(c)}if(r.length>0)return;var g=i.pens.getPen(l),p=0;if(g.values.length>0&&(p=new Date(g.values[g.values.length-1].DateTime).getTime(),new Date(a).getTime()<=p))return;i.pens.addPoint(l,{DateTime:a,Value:parseFloat(t.value),OpcQuality:192,FakeValue:!1})}})})}},{key:"_addExistedPenValue",value:function(e,t,i){var a=e.values.filter(function(e){var a=new Date(e.DateTime).getTime();return t>a||a>i?!1:!0});this.pens.addPenValues(e.index,a)}},{key:"_getMinIndex",value:function(e){var t=e.value.indexes[0].index;t<=this._minPenIndex&&(this._minPenIndex=t)}},{key:"queryResults",value:function(e){var t=this;if(this._globals.initialized===!1){this._helper.parseDates(this._globals.scope),this._globals.loaderTrigger(),this._chart=angular.element('<wwline-chart data="data" options="options" style="height:100%; width:100%;" onselectstart="return false">></wwline-chart>'),this._chart.appendTo(".chart-container"),this._globals.compile(this._chart)(this._globals.scope);var i=$(".loader");if(i.css("background-color","transparent"),i.css("border-style","none"),this._globals.initialized=!0,!e.value.unusable)return void this._startQuery();this._globals.onlineOnly=!0,this._globals.loaderHide()}return e.value&&(this._getMinIndex(e),e.value.indexes[0].index===this._minPenIndex&&this._globals.queryCounter--),e.value&&e.value.rows&&this._globals.onlineOnly!==!0?(this._redrawPen(e),this._globals.waittingQueryResult=!1,this._globals.loaderHide(),this._globals.redraw(),1!=this._globals.scope.options.grid.visible&&setTimeout(function(){t._globals.scope.options.grid.visible=!0,t._globals.redraw()},500),void(this._isHidden&&setTimeout(function(){t._globals.chartVisibility("visible")},1e3))):void(this._globals.enableActiveUpdateTrigger=!0)}},{key:"_startQuery",value:function(){this._globals.running===!0&&this._globals.readyToInitializedTimeTag===!0&&(this._globals.enableActiveUpdateTrigger=!1),this.pens._pens.forEach(function(e){e._needClearValues=!0}),this._isQueryAll===!1,this._startQueryFromDuration(this.axes.x.minMax[d.MIN],this.axes.x.minMax[d.MAX])}},{key:"_startQueryFromDuration",value:function(e,t){return this._globals.initialized!==!1?(this._globals.waittingQueryResult=!1,null===this._globals.chartArea?(null!==this._timeOutStartQuery&&(clearTimeout(this._timeOutStartQuery),this._timeOutStartQuery=null),void(this._timeOutStartQuery=setTimeout(this._startQuery.bind(this),10))):void(this._globals.queryCounter>0||(this._globals.queryCounter++,0!==this._globals.queryCounter&&this._proxyManager.setTrendQuery(parseInt((e/1e3).toFixed()),parseInt((t/1e3).toFixed()),this._globals.chartArea.w)))):void 0}},{key:"_updateMultiScales",value:function(){if(null!=this._globals.scope.$$childTail&&null!=this._globals.scope.$$childTail.canvas){var e=this._globals.scope.options.multipleScales.visiblePens,t=this._globals.scope.$$childTail.canvas.height,i=parseInt(t/2/13.2);i<e.length&&(this._globals.scope.options.multipleScales.visiblePens=e.slice(e.length-i)),this._globals.scope.$apply()}}},{key:"on",value:function(e,t){this._ee.on(e,t)}}]),e}();new m},{"./Axes":1,"./Legend":2,"./Pens":3,"./Toolbar":4,"./Zoom":5,"./misc/Data":6,"./misc/Enums":7,"./misc/Globals":8,"./misc/Helper":9,"./misc/Module":10,"./misc/ProxyManager":11,"./misc/ToolbarButton":12}]},{},[13]);
//# sourceMappingURL=Z:/.helpers/tasks/../../dailybuilds/trend/trend/build/build.min.js.map