!function(){function e(t,a,r){function i(n,l){if(!a[n]){if(!t[n]){var s="function"==typeof require&&require;if(!l&&s)return s(n,!0);if(o)return o(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[n]={exports:{}};t[n][0].call(d.exports,function(e){var a=t[n][1][e];return i(a||e)},d,d.exports,e,t,a,r)}return a[n].exports}for(var o="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}return e}()({1:[function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();a.CellRender=function(){function e(t,a){r(this,e),this._dgrid=t,this._helper=new window.SmaCustomWidget.Helper,this._alarm=a,this.label="",this.width=0}return i(e,[{key:"renderHeaderCell",value:function(e){"ackReq"!=e.field?e.innerHTML=this.label.replace(/"/g,""):($(e).addClass("alarm-ack-header"),$(e).css({"background-size":"20px 20px","background-repeat":"no-repeat","background-position":"center"})),$(e).css("width",this.width+"px"),$(e).css("vertical-align","middle"),-1==this.width&&$(e).css("display","none")}},{key:"_iconRender",value:function(e,t,a){this.showGridLines(a);var r=this._dgrid.cell(a).column;$(a).addClass("ack-require-img"),$(a).css({"background-size":"16px 16px","background-repeat":"no-repeat","background-position":"center"}),$(a).css("width",r.width+"px"),$(a).css("vertical-align","middle"),$(a).css("text-align","center")}},{key:"_textRender",value:function(e,t,a){var r=this._dgrid.column(a.columnId),i=t;if(i&&i.length>0)switch(r.field){case"group":i=parseInt(t);break;case"ackTime":case"normTime":case"eventTime":case"activationTime":var o="local_only"==this._alarm._timeZoneType&&this._alarm._type!=this._alarm.enumAlarmType.ONLINE?!1:!0,n=this._helper.strToDateTime(t,o,!0);i=this._alarm._parseDateTime(n);break;default:i=t}this._alarm._showGridLines?a.className=a.className+" alarm-cell-border alarm-cell":a.className=a.className+" alarm-cell-border-none alarm-cell",a.style.textAlign=r.align,a.style.borderStyle="none",a.style.padding="0px","-1"==r.width?a.style.display="none":a.style.width=r.width+"px",a.style.verticalAlign="middle",$(".dgrid-column-"+a.columnId).css("text-align",r.align),a.innerHTML=i}},{key:"_emptyRender",value:function(e,t,a){$(a).addClass("alarm-cell-border-none")}},{key:"showGridLines",value:function(e){this._alarm._showGridLines?($(e).removeClass("alarm-cell-border-none"),$(e).addClass("alarm-cell-border")):($(e).removeClass("alarm-cell-border"),$(e).addClass("alarm-cell-border-none"))}},{key:"getRender",value:function(e){return"ackReq"==e?this._iconRender.bind(this):"internalEmptyColumn"==e?this._emptyRender.bind(this):this._textRender.bind(this)}}]),e}()},{}],2:[function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();a.Columns=function(){function e(){r(this,e),this._columns=[],this._isChangedColumns=!1,cwidget.on("ColumnsCount",this.addColumns.bind(this))}return i(e,[{key:"_addColumn",value:function(e){this._columns[e]={label:"",field:"",width:100,align:"Left",sortable:!0}}},{key:"getColumn",value:function(e){return this._columns[e]}},{key:"_onColumnChange",value:function(e,t){var a=this.getColumn(t),r=e.replace("Column","");r=r[0].toLowerCase()+r.substring(1),a[r]=cwidget[e][t],this._isChangedColumns=!0}},{key:"addColumns",value:function(){var e=-1,t=parseInt(cwidget.ColumnsCount),a=["ColumnLabel","ColumnField","ColumnWidth","ColumnAlign"];for(e=0;t>e;e++)this._addColumn(e);for(e=0;e<a.length;e++)cwidget.on(a[e],this._onColumnChange.bind(this))}},{key:"count",value:function(){return this._columns.length}},{key:"get",value:function(){return this._columns}},{key:"validateColunm",value:function(e){for(var t=0;t<this._columns.length;t++)if(this._columns[t].field===e)return!0;return!1}},{key:"getIsChangedColumns",value:function(){return this._isChangedColumns}},{key:"setIsChangedColumns",value:function(e){this._isChangedColumns&&(this._isChangedColumns=e)}}]),e}()},{}],3:[function(e,t,a){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=e("./Columns"),n=e("./CellRender"),l=function(){function e(t,a){var i=this;r(this,e);var l=-1,s=["Day","Month","Year","Hour","Minute","Second","MS"],c=["BackgroundColor","FontName","FontStyle","FontSizeInPoints","FontColor","AckColor","NormColor","ActiveColor"];for(this.EnumRuntimeScadaEngine={InduSoft:0,ArchestrA:1,ClearSCADA:2},this.EnumToolItem={AckVisible:0,AckSelected:1,AckAll:2},this._selectedToolItem=-1,this._alarmWorksheetColors=[],this._firstRowValues=[],this._selectedValues=[],this._dgrid=new t({},"alarm"),this._touchUtil=a,this._originalInsertRow=this._dgrid.insertRow.bind(this._dgrid),this._originalRenderRow=this._dgrid.renderRow.bind(this._dgrid),this._dgrid.insertRow=this._preTreatRow.bind(this),this._dgrid.renderRow=this._preRenderRow.bind(this),this._helper=new window.SmaCustomWidget.Helper,this._helper.addFindToArray(),this._cellRender=new n.CellRender(this._dgrid,this),this.columns=new o.Columns,this._worksheetConfigColors="",cwidget.on("WorksheetConfigColors",this._updateAlarmConfigColors.bind(this)),cwidget.on("AckTrigger",this._receiveAck.bind(this)),cwidget.on("AckAllTrigger",this._receiveAckAll.bind(this)),cwidget.on("AckComment",this._receiveAckComment.bind(this)),cwidget.on("DisableAckOnDoubleClick",this._receiveDisableAckOnDoubleClick.bind(this)),cwidget.on("RequireConfirmation",this._receiveAckRequireConfirmation.bind(this)),cwidget.on("ShowGridLines",this.showGridLines.bind(this)),cwidget.on("ShowAlarmState",this.showAlarmState.bind(this)),cwidget.on("TimeZoneType",this.timeZoneType.bind(this)),cwidget.on("Type",this.type.bind(this)),cwidget.on("ShowHeader",this.showHeader.bind(this)),cwidget.on("ESign",this.eSign.bind(this)),l=0;l<c.length;++l)cwidget.on(c[l],this._scheduleUpdateAlarm.bind(this));for(l=0;l<s.length;++l)cwidget.on(s[l],this._scheduleUpdateAlarmData.bind(this));cwidget.on("QueryResults",this.queryResults.bind(this)),cwidget.on("AlarmDataUpdate",this._executeUpdateAlarmData.bind(this)),this._dgrid.on("dgrid-sort",this._onSort.bind(this)),this._dgrid.on(a.selector(".dgrid-sortable","mousemove"),this._onHeaderMouseMove.bind(this)),this._dgrid.on(a.selector(".dgrid-sortable","mousedown"),this._onHeaderMouseDown.bind(this)),this._dgrid.on(a.selector(".dgrid-row",a.dbltap),this._onDoubleTap.bind(this)),this._dgrid.on(a.selector(".dgrid-row","click"),this._treatSelection.bind(this)),this._dgrid.on(a.selector(".dgrid-row","dblclick"),this._onDoubleClick.bind(this)),this._dgrid._setSort=function(){},this._dgrid.startup(),this._alarmData=[],this._alarmState=[],this._alarmStateColor=[],this.forceGetAll=!0,this._disableAckOnDoubleClick=!1,this._onUpdateAlarmDataTimeout=null,this._sorted_field=null,this._sorted_field_desc=!1,setTimeout(this._preventMove.bind(this),100),this._preventMoveInit=!1,this._hasOpenWindow=!1,this._windowResult=null,this._ackRow=-1,this._isAckAll=!1,this._oldX=0,this._oldWidth=0,this._dgridOldWidth=0,this._resizeCellIndex=0,this._hasResize=!1,this._resizeEventListener=!1,this._flashUnackAlarmHiHiRows=[],this._flashUnackAlarmHiRows=[],this._flashUnackAlarmLoRows=[],this._flashUnackAlarmLoLoRows=[],this._selectedRows=[],this._isInitial=!0,this._isPendingChange=!0,this._interval=null,this.enumAlarmType={ONLINE:0,HISTORY:1,HISTORY_EVENT:2,EVENT:3},this.enumUpdateType={FIRST_ROW:-2,SELECTED_ROW:-1},this._onCloseCallbackInterval=setInterval(function(){cwidget.host&&(clearInterval(i._onCloseCallbackInterval),cwidget.host.onCloseWindowCallback=i.onCloseWindow.bind(i))},100);var d=this,h=null,u=function(){return null!=cwidget._proxy?(cwidget._proxy.addOnShow(d._onShow.bind(d)),cwidget._proxy.addOnHide(d._onHide.bind(d)),cwidget._proxy.registerTouchEvents&&cwidget._proxy.registerTouchEvents(),null!=h&&(clearInterval(h),h=null),!0):!1};u()||(h=setInterval(u,10)),this._resultCallBackAfteCheckESign=null,this._initSort()}return i(e,[{key:"_onDoubleTap",value:function(e){if(cwidget.Engine!=this.EnumRuntimeScadaEngine.ArchestrA&&!(this._disableAckOnDoubleClick||this._type!=this.enumAlarmType.ONLINE||cwidget.Security>0&&0===cwidget._proxy.securityLevels[cwidget.Security])){var t=this._dgrid.row(e);t&&this._performAck(t)}}},{key:"_onDoubleClick",value:function(e){var t=this;if(cwidget.Engine!=this.EnumRuntimeScadaEngine.ArchestrA){var a=null;this._disableAckOnDoubleClick||this._type!=this.enumAlarmType.ONLINE||cwidget.Security>0&&0===cwidget._proxy.securityLevels[cwidget.Security]||("touchend"==e.type?e.path.forEach(function(e){var r=$(e);r.hasClass("dgrid-row")&&(a=t._dgrid.row(e))}):a=this._dgrid.row(e),a&&this._performAck(a))}}},{key:"_preTreatRow",value:function(e,t,a,r,i){return this._originalInsertRow(e,t,a,r,i)}},{key:"_scheduleUpdateAlarm",value:function(){this._onUpdateAlarmTimeout&&(clearTimeout(this._onUpdateAlarmTimeout),this._onUpdateAlarmDataTimeout=null),this._onUpdateAlarmTimeout=setTimeout(this._executeUpdateAlarm.bind(this),100)}},{key:"_executeUpdateAlarm",value:function(){var e=this,t=0;if(!this._initColumns())return function(){var t=$("#dynamic-style"),a="";a+=".dgrid-scroller {background-color:"+e._helper.numToRGB(cwidget.BackgroundColor)+";}",a+=".dgrid .dgrid-row {background-color:"+e._helper.numToRGB(cwidget.BackgroundColor)+";}",t[0]&&(t[0].innerHTML=a,t.appendTo($("head")))}(),void setTimeout(this._executeUpdateAlarm.bind(this),1);this._columns.forEach(function(a){t+=parseInt(a.width),a.renderCell=e._cellRender.getRender(a.field),a.renderHeaderCell=e._cellRender.renderHeaderCell,cwidget.Engine==e.EnumRuntimeScadaEngine.ArchestrA?a.sortable=cwidget.AllowSorting:a.sortable="1"===cwidget.FilterAllowSort?!0:!1});var a=Math.min(window.innerWidth,document.body.clientWidth);if(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA&&0==document.body.clientWidth&&(a=window.innerWidth),$(this._dgrid.domNode).css("width",a+"px"),!this._hasInternalEmptyColumn&&t>0&&a>t){this._hasInternalEmptyColumn=!0;var r={align:"center",field:"internalEmptyColumn",id:"internalEmptyColumn",label:"",sortable:!1,width:a-t-10};r.renderCell=this._cellRender.getRender(r.field),this._columns.push(r)}this._dgrid.set("showHeader",parseInt(cwidget.ShowHeader)),this._dgrid.set("columns",this._columns),this.updateStyleSheetLayout(),this._onUpdateAlarmTimeout=null,this._refreshAlarmState()}},{key:"_initColumns",value:function(){if(this._columns&&this._columns.length>0&&!this.columns.getIsChangedColumns())return!0;this.columns.setIsChangedColumns(!1);var e=this.columns.get();if(!e||0==e.length)return setTimeout(this._initColumns.bind(this),1),!1;var t=0;for(this._columns=[];;){if(!e[t])break;cwidget.Engine!=this.EnumRuntimeScadaEngine.ArchestrA&&(e[t].sortable="1"===cwidget.FilterAllowSort?!0:!1),this._columns.push(e[t]),t++}return!0}},{key:"_scheduleUpdateAlarmData",value:function(){this._onUpdateAlarmDataTimeout&&clearTimeout(this._onUpdateAlarmDataTimeout),this._onUpdateAlarmDataTimeout=setTimeout(this._executeUpdateAlarmData.bind(this),100)}},{key:"_executeUpdateAlarmData",value:function(){if(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA){if(!this._isPendingChange||window.parent.panAndZoomSupport&&null!=window.parent.panAndZoomSupport.pointerPoints&&window.parent.panAndZoomSupport.pointerPoints.length>0)return;this._refreshGridNotResetScrollbar()}else this._dgrid.refresh();this._dgrid.renderArray(this._alarmData),this._onUpdateAlarmDataTimeout=null,this._refreshAlarmState();var e=this._updateFirstRowValues();this._isPendingChange=!1,e&&(this.updateData(0,this.enumUpdateType.FIRST_ROW,e),this._isInitial&&this._alarmData&&this._alarmData.length>0&&(this._isInitial=!1))}},{key:"updateData",value:function(e,t,a){var r=cwidget.getPropertyId("UpdateCurrent");null!=r&&cwidget.services.updateData(cwidget.host.screenId,r,parseInt(e),parseInt(t),a)}},{key:"_updateAlarmConfigColors",value:function(){var e=this;if(!this._initColumns())return void setTimeout(this._updateAlarmConfigColors.bind(this),1);var t="",a=-1,r=JSON.parse(cwidget.WorksheetConfigColors.colors);this._columns.forEach(function(e,t){return"ackReq"==e.field?void(a=t):void 0}),r.forEach(function(r){var i=r.group_number,o=JSON.parse(r.colors);o={active:{fg:e._helper.numToRGB(o.fgActiveColor),bg:e._helper.numToRGB(o.bgActiveColor)},norm:{fg:e._helper.numToRGB(o.fgNormColor),bg:e._helper.numToRGB(o.bgNormColor)},ack:{fg:e._helper.numToRGB(o.fgAckColor),bg:e._helper.numToRGB(o.bgAckColor)}},e._alarmWorksheetColors[i]=o,-1==a?(t+=".alarm-active.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-internalEmptyColumn) {color: "+o.active.fg+";background-color: "+o.active.bg+"}",t+=".alarm-ack-normalized.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-internalEmptyColumn),.alarm-normalized.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-internalEmptyColumn) {color: "+o.norm.fg+";background-color: "+o.norm.bg+"}",t+=".alarm-ack.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-internalEmptyColumn) {color: "+o.ack.fg+";background-color: "+o.ack.bg+"}"):(t+=".alarm-active.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-"+a+"):not(.dgrid-column-internalEmptyColumn) {color: "+o.active.fg+";background-color: "+o.active.bg+"}",t+=".alarm-ack-normalized.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-"+a+"):not(.dgrid-column-internalEmptyColumn),.alarm-normalized.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-"+a+"):not(.dgrid-column-internalEmptyColumn) {color: "+o.norm.fg+";background-color: "+o.norm.bg+"}",t+=".alarm-ack.alarm-style-group-"+i+" .dgrid-cell:not(.dgrid-column-"+a+"):not(.dgrid-column-internalEmptyColumn) {color: "+o.ack.fg+";background-color: "+o.ack.bg+"}")}),this._worksheetConfigColors=t,this.updateStyleSheetLayout()}},{key:"ackAlarm",value:function(e,t){if(!(null==cwidget||null==cwidget.host||null==cwidget.host.screenId||cwidget.host.screenId<0))if(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA)e.unshift(cwidget.host.screenId),cwidget.services.ackAlarmEx(e,t,cwidget.AlarmDataLocator,"","");else{var a=cwidget.getPropertyId("QueryResults");if(null==a)return;var r={alarm_ids:e,comment:t,screenId:cwidget.host.screenId,dataSourceId:a},i={zIndex:30001};cwidget.host.widget.checkESign("ackAlarm",r,cwidget.host.widget.esign,{completeESignCallBack:this._resultCallBackAfteCheckESign},i)}}},{key:"showMessageBox",value:function(e,t,a,r){var i={input:{Title:e,Message:t,Icon:a,Buttons:r},output:{ReturnValue:null}};this._showWindow(cwidget.enumWindowType.MSGBOX,i)}},{key:"showInput",value:function(e,t,a,r){var i={message:e,password:t,required:a,errorMessage:r};this._showWindow(cwidget.enumWindowType.INPUT,i)}},{key:"_showWindow",value:function(e,t){this.setOpenWindow(e),cwidget.host.showWindow(e,t)}},{key:"_refreshGridNotResetScrollbar",value:function(){this._dgrid.cleanup(),this._dgrid._rowIdToObject={},this._dgrid_autoRowId=0,this._dgrid.contentNode.innerHTML="",window.parent.panAndZoomSupport&&window.parent.panAndZoomSupport.pointerPoints&&(window.parent.panAndZoomSupport.pointerPoints=[])}},{key:"_refreshAlarmState",value:function(){var e=0,t=$(".dgrid-row",this._dgrid.domNode);if(this._flashUnackAlarmHiHiRows.length=0,this._flashUnackAlarmHiRows.length=0,this._flashUnackAlarmLoRows.length=0,this._flashUnackAlarmLoLoRows.length=0,!(t.length<=0)){for(e=0;e<t.length;++e){var a=this._dgrid.row(t[e]);switch(this._alarmStateColor[a.data._notSortedRowIndex].toUpperCase()){case"ACK":this._setAckColor(a);break;case"NORM":this._setNormColor(a);break;case"EVENT":this._setEventColor(a);break;case"ACK_HIHI":this._setAckHiHiColor(a);break;case"ACK_HI":this._setAckHiColor(a);break;case"ACK_LO":this._setAckLoColor(a);break;case"ACK_LOLO":this._setAckLoLoColor(a);break;case"UNACK_HIHI":this._setUnAckHiHiColor(a);break;case"UNACK_HI":this._setUnAckHiColor(a);break;case"UNACK_LO":this._setUnAckLoColor(a);break;case"UNACK_LOLO":this._setUnAckLoLoColor(a);break;case"FLASHUNACK_HIHI":this._setUnAckHiHiColor(a),this._addRowIntoRowsArray(a,this._flashUnackAlarmHiHiRows);break;case"FLASHUNACK_HI":this._setUnAckHiColor(a),this._addRowIntoRowsArray(a,this._flashUnackAlarmHiRows);break;case"FLASHUNACK_LO":this._setUnAckLoColor(a),this._addRowIntoRowsArray(a,this._flashUnackAlarmLoRows);break;case"FLASHUNACK_LOLO":this._setUnAckLoLoColor(a),this._addRowIntoRowsArray(a,this._flashUnackAlarmLoLoRows);break;case"ALARM_RTN":this._setAlarmRTNColor(a);break;case"SHELVE":this._setShelveColor(a);break;default:this._setActiveColor(a)}}this._flashUnackAlarmHiHiRows.length>0||this._flashUnackAlarmHiRows.length>0||this._flashUnackAlarmLoRows.length>0||this._flashUnackAlarmLoLoRows.length>0?null==this._flashUnackAlarmsColor&&this._setFlashUnAckAlarmsColor():(clearInterval(this._flashUnackAlarmsColor),this._flashUnackAlarmsColor=null)}}},{key:"_isAlarmAck",value:function(e){return"ACK"==this._alarmState[e]||"ACK_NORM"==this._alarmState[e]?!0:!1}},{key:"updateStyleSheetLayout",value:function(){var e=$("#dynamic-style"),t="",a=this._helper.parseFontStyle(cwidget.FontStyle);t+=".dgrid-scroller {background-color:"+this._helper.numToRGB(cwidget.BackgroundColor)+";}",t+=".dgrid .dgrid-row {background-color:"+this._helper.numToRGB(cwidget.BackgroundColor)+";}",t+=".dgrid {color: "+cwidget.FontColor+";}",t+=".dgrid {font-family: "+cwidget.FontName+";}",t+=".dgrid {font-style: "+cwidget.FontStyle+";}",t+=".dgrid {font-weight: "+a.fontWeight+";}",t+=".dgrid {font-size: "+cwidget.FontSizeInPoints+"pt;}",t+=".alarm-cell {font-size: "+cwidget.FontSizeInPoints+"pt;}",t+=".alarm-cell {height: "+1.1*cwidget.FontSizeInPoints+"pt;}",cwidget.Engine&&cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA&&(t+=".alarm-cell-border {border: solid !important;border-width: thin !important;border-color: "+this._helper.numToRGB(cwidget.GridLineColor)+" !important;}",t+=".dgrid-header .dgrid-cell {background-color: "+this._helper.numToRGB(cwidget.HeadingBGColor)+" !important;color: "+this._helper.numToRGB(cwidget.HeadingFontColor)+" !important;}",t+=".alarm-ack-hihi {color: "+this._helper.numToRGB(cwidget.AckColorInfoFontColorHiHi)+"!important ;background-color: "+this._helper.numToRGB(cwidget.AckColorBGColorHiHi)+"!important;}",t+=".alarm-ack-hi {color: "+this._helper.numToRGB(cwidget.AckColorInfoFontColorHi)+"!important;background-color: "+this._helper.numToRGB(cwidget.AckColorBGColorHi)+"!important;}",t+=".alarm-ack-lo {color: "+this._helper.numToRGB(cwidget.AckColorInfoFontColorLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.AckColorBGColorLo)+"!important;}",t+=".alarm-ack-lolo {color: "+this._helper.numToRGB(cwidget.AckColorInfoFontColorLoLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.AckColorBGColorLoLo)+"!important;}",t+=".alarm-unack-hihi {color: "+this._helper.numToRGB(cwidget.UNAckColorInfoFontColorHiHi)+"!important;background-color: "+this._helper.numToRGB(cwidget.UNAckColorBGColorHiHi)+"!important;}",t+=".alarm-unack-hi {color: "+this._helper.numToRGB(cwidget.UNAckColorInfoFontColorHi)+"!important;background-color: "+this._helper.numToRGB(cwidget.UNAckColorBGColorHi)+"!important;}",t+=".alarm-unack-lo {color: "+this._helper.numToRGB(cwidget.UNAckColorInfoFontColorLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.UNAckColorBGColorLo)+"!important;}",t+=".alarm-unack-lolo {color: "+this._helper.numToRGB(cwidget.UNAckColorInfoFontColorLoLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.UNAckColorBGColorLoLo)+"!important;}",t+=".alarm-flashunack-hihi {color: "+this._helper.numToRGB(cwidget.FlashUnackColorInfoFontColorHiHi)+"!important;background-color: "+this._helper.numToRGB(cwidget.FlashUnackColorBGColorHiHi)+"!important;}",t+=".alarm-flashunack-hi {color: "+this._helper.numToRGB(cwidget.FlashUnackColorInfoFontColorHi)+"!important;background-color: "+this._helper.numToRGB(cwidget.FlashUnackColorBGColorHi)+"!important;}",t+=".alarm-flashunack-lo {color: "+this._helper.numToRGB(cwidget.FlashUnackColorInfoFontColorLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.FlashUnackColorBGColorLo)+"!important;}",t+=".alarm-flashunack-lolo {color: "+this._helper.numToRGB(cwidget.FlashUnackColorInfoFontColorLoLo)+"!important;background-color: "+this._helper.numToRGB(cwidget.FlashUnackColorBGColorLoLo)+"!important;}",t+=".alarm-rtn {color: "+this._helper.numToRGB(cwidget.AlarmRTNFontColor)+"!important;background-color: "+this._helper.numToRGB(cwidget.AlarmRTNBGColor)+"!important;}",t+=".alarm-shelve {color: "+this._helper.numToRGB(cwidget.ShelveFontColor)+"!important;background-color: "+this._helper.numToRGB(cwidget.ShelveBGColor)+"!important;}",t+=".alarm-event {color: "+this._helper.numToRGB(cwidget.EventFontColor)+"!important;background-color: "+this._helper.numToRGB(cwidget.EventBGColor)+"!important;}",t+=".alarm-selected {color: white!important;background-color: blue!important;}"),t+=this._worksheetConfigColors,e[0]&&(e[0].innerHTML=t,e.appendTo($("head")),this._gridResize())}},{key:"_gridResize",value:function(){if(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA&&cwidget.host&&cwidget.host.widget){var e=cwidget.host.widget.getParentScreen(),t=null;e&&e.domNode&&e.domNode.parentNode&&e.domNode.parentNode.parentNode&&e.domNode.parentNode.parentNode.className.indexOf("carousel-item")>-1&&(t=e.domNode.parentNode.parentNode),null!=t?(t.style.display="block",this._dgrid.resize(),t.style.display=""):this._dgrid.resize()}else this._dgrid.resize()}},{key:"_checkHorizontalScrollBar",value:function(){var e=$(".dgrid-content").get(0).scrollWidth>window.outerWidth;if(e===!0){var t=$("#alarm").css("height");$("#alarm").css("height",parseFloat(t)-20+"px")}}},{key:"_checkVerticalScrollBar",value:function(){var e="0px",t=$(".dgrid-content").get(0).scrollHeight>$(".dgrid-content").get(0).clientHeight;t===!0&&(e=parseInt($(".dgrid-header-row").css("height"))+"px",$(".dgrid-header-scroll").css("height",e))}},{key:"_receiveAck",value:function(){this._type==this.enumAlarmType.ONLINE&&this._lastSelection&&this._performAck(this._lastSelection)}},{key:"_receiveAckAll",value:function(){this._type==this.enumAlarmType.ONLINE&&(this._isAllAlarmsAck()||(this._ackRequireConfirmation?(this._isAckAll=!0,this.showMessageBox("Mobile Access","Confirm 'Acknowledge'?",32,4)):this._endAckAll()))}},{key:"_isAllAlarmsAck",value:function(){for(var e=this._alarmData.length,t=0;e>t;++t){var a=this._dgrid.row(t);if(!this._isAlarmAck(a.data._notSortedRowIndex))return!1}return!0}},{key:"_receiveAckComment",value:function(){this._ackComment=parseInt(cwidget.AckComment)}},{key:"_receiveDisableAckOnDoubleClick",value:function(){this._disableAckOnDoubleClick=parseInt(cwidget.DisableAckOnDoubleClick)}},{key:"_receiveAckRequireConfirmation",value:function(){this._ackRequireConfirmation=parseInt(cwidget.RequireConfirmation)}},{key:"_onHeaderMouseDown",value:function(e){if(this._hasResize=!1,e.offsetX>e.target.offsetWidth-10){this._dgrid.mouseDown=!0;var t=this;this._resizeEventListener||(document.addEventListener("mousemove",function(e){t._onGridMouseMove(e)},!1),document.addEventListener("mouseup",function(e){t._onGridMouseUp(e)},!1)),this._oldX=e.x,this._oldWidth=e.target.offsetWidth,this._dgridOldWidth=$(".dgrid-content")[0].offsetWidth,this._resizeCellIndex=e.target.cellIndex}}},{key:"_onGridMouseMove",value:function(e){var t=this;if(null!=this._dgrid.mouseDown&&1==this._dgrid.mouseDown){this._hasResize=!0;var a=e.x-this._oldX,r=e.target.width;if(this._oldWidth+a>0&&this._dgridOldWidth+a>$(".dgrid-header")[0].offsetWidth){if(r=this._oldWidth+a,30>r&&(r=30,a=30-this._oldWidth),r!=this._oldWidth){var i=$("#alarm table").toArray();i.forEach(function(e){void 0!=e.rows[0].cells[t._resizeCellIndex]&&(e.rows[0].cells[t._resizeCellIndex].style.width=r+"px")});var o=$(".dgrid-content")[0];o.style.width=this._dgridOldWidth+a+"px"}this._columns[this._resizeCellIndex].width=r}}}},{key:"_onHeaderMouseMove",value:function(e){e.offsetX>e.target.offsetWidth-10?e.target.style.cursor="col-resize":e.target.style.cursor="default"}},{key:"_onGridMouseUp",value:function(e){this._dgrid.mouseDown&&(this._dgrid.mouseDown=!1,e.target.style.cursor="default")}},{key:"_onSort",value:function(e){if(!this._hasResize){var t=e.sort[0],a=t.property;this._sorted_field=a;var r=t.descending;this._sorted_field_desc=r,e.preventDefault(),this._doSort(a,r),this._executeUpdateAlarmData(),this._dgrid.updateSortArrow(e.sort,!0),this._executeUpdateAlarm(),"ackReq"==this._sorted_field&&$(".dgrid-sort-arrow").css("display","none")}}},{key:"_doSort",value:function(e,t){var a=this;this._dgrid._lastCollection.sort(function(r,i){var o=null,n=null,l=null,s=null,c=[],d=[];Array.isArray(e)?c=e:c.push(e),Array.isArray(t)?d=t:d.push(t);for(var h=0;h<c.length;h++){switch(l=c[h],s=d[h],"ackReq"==l?(o="ACK"==a._alarmState[r._notSortedRowIndex]||"ACK_NORM"==a._alarmState[r._notSortedRowIndex]?1:0,n="ACK"==a._alarmStateColor[i._notSortedRowIndex]||"ACK_NORM"==a._alarmState[i._notSortedRowIndex]?1:0):(o=r[l],n=i[l]),l){case"group":case"ackReq":o=parseInt(o),n=parseInt(n);break;case"ackTime":case"normTime":case"eventTime":case"activationTime":if(o=a._parseDate(o),n=a._parseDate(n),!o&&!n)return 0;if(!o)return s?-1:1;if(!n)return s?1:-1;o==n&&(o=a._parseDate(r._internalEventTime),n=a._parseDate(i._internalEventTime));break;default:isNaN(o)&&(o=o.toLowerCase()),isNaN(n)&&(n=n.toLowerCase())}if(o>n)return s?-1:1;if(n>o)return s?1:-1}return 0})}},{key:"_parseDate",value:function(e){var t=null,a=[],r=Date.parse(e);if(isNaN(r)){if(a=e.split(/[-T:.Z]/),7!=a.length)return null;t=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]),parseInt(a[3]),parseInt(a[4]),parseInt(a[5]),parseInt(a[6])),r=t.getTime()}return r}},{key:"_preventMove",value:function(){return this._preventMoveInit===!0?void console.warn("Prevent move is already initialized."):(this._preventMoveInit=!0,$(cwidget.parent).on("mousemove touchmove",function(e){e.preventDefault()}),$(".grid-container").on("mousemove touchmove",function(e){e.target===$(".grid-container")[0]&&e.preventDefault()}),void $(".grid").on("mousemove touchmove",function(e){e.target===$(".grid")[0]&&e.preventDefault()}))}},{key:"_preRenderRow",value:function(e,t){var a=this._originalRenderRow(e,t);return a}},{key:"_treatSelection",value:function(e){var t=this,a=null,r=null;if(null!==this._onSendDataTimeout&&(clearTimeout(this._onSendDataTimeout),this._onSendDataTimeout=null),e){if(a=this._dgrid.row(e),cwidget.Engine!=this.EnumRuntimeScadaEngine.ArchestrA)this._lastSelection&&$(this._lastSelection.element).css("outline",""),this._lastSelection=a,$(this._lastSelection.element).css("outline","2px dotted white");else if(e.ctrlKey)$(a.element).hasClass("alarm-selected")?($(a.element).css("outline",""),$(a.element).removeClass("alarm-selected"),this._removeRowFromRowsArray(a,this._selectedRows),this._removeOrAddSelectedFromFlashUnackAlarmsRows(a,!1)):($(a.element).css("outline","2px dotted white"),$(a.element).addClass("alarm-selected"),this._addRowIntoRowsArray(a,this._selectedRows),this._removeOrAddSelectedFromFlashUnackAlarmsRows(a,!0)),this._lastSelection=a;else if(e.shiftKey){null==this._lastSelection&&(this._lastSelection=a);for(var i=0;i<this._selectedRows.length;i++){var o=this._selectedRows[i];$(o.element).css("outline",""),$(o.element).removeClass("alarm-selected"),this._removeOrAddSelectedFromFlashUnackAlarmsRows(o,!1)}this._selectedRows=[];var n=parseInt(this._lastSelection.id),l=parseInt(a.id);if(n>l){var s=l;l=n,n=s}for(var i=n;l>=i;i++){var o=this._dgrid.row(i);$(o.element).css("outline","2px dotted white"),$(o.element).addClass("alarm-selected"),this._addRowIntoRowsArray(o,this._selectedRows),this._removeOrAddSelectedFromFlashUnackAlarmsRows(o,!0)}}else{for(var i=0;i<this._selectedRows.length;i++){var o=this._selectedRows[i];$(o.element).css("outline",""),$(o.element).removeClass("alarm-selected"),this._removeOrAddSelectedFromFlashUnackAlarmsRows(o,!1)}this._selectedRows=[a],this._lastSelection=a,$(a.element).css("outline","2px dotted white"),$(a.element).addClass("alarm-selected")}r=a.data,this._columns.forEach(function(e,a){var i=null;if(e.field&&"internalEmptyColumn"!=e.field&&(i=r[e.field],void 0!==i))if("expression"==e.field&&(t._tagName=i),t.isDateTimeColumn(e.field)){var o="local_only"==t._timeZoneType&&t._type!=t.enumAlarmType.ONLINE?!1:!0,n=t._helper.strToDateTime(i,o,!0);t._selectedValues[a]=t._parseDateTime(n)}else"ackReq"==e.field?t._selectedValues[a]=i?"1":"0":t._selectedValues[a]=i}),cwidget.SelectedTag=this._tagName,this.updateData(r._notSortedRowIndex,this.enumUpdateType.SELECTED_ROW,this._selectedValues)}}},{key:"_removeOrAddSelectedFromFlashUnackAlarmsRows",value:function(e,t){switch(this._alarmStateColor[e.data._notSortedRowIndex].toUpperCase()){case"FLASHUNACK_HIHI":t?this._removeRowFromRowsArray(e,this._flashUnackAlarmHiHiRows):this._addRowIntoRowsArray(e,this._flashUnackAlarmHiHiRows);break;case"FLASHUNACK_HI":t?this._removeRowFromRowsArray(e,this._flashUnackAlarmHiRows):this._addRowIntoRowsArray(e,this._flashUnackAlarmHiRows);break;case"FLASHUNACK_LO":t?this._removeRowFromRowsArray(e,this._flashUnackAlarmLoRows):this._addRowIntoRowsArray(e,this._flashUnackAlarmLoRows);break;case"FLASHUNACK_LOLO":t?this._removeRowFromRowsArray(e,this._flashUnackAlarmLoLoRows):this._addRowIntoRowsArray(e,this._flashUnackAlarmLoLoRows)}}},{key:"_removeRowFromRowsArray",value:function(e,t){var a=t.filter(function(t){return t.id==e.id});if(a.length>0){var r=t.indexOf(a[0]);r>-1&&t.splice(r,1)}}},{key:"_addRowIntoRowsArray",value:function(e,t){var a=t.filter(function(t){return t.id==e.id});0==a.length&&t.push(e)}},{key:"isDateTimeColumn",value:function(e){switch(e){case"ackTime":case"normTime":case"eventTime":case"activationTime":return!0;default:return!1}}},{key:"queryResults",value:function(){var e=cwidget.QueryResults;return this._initColumns()?void(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA?(this._isPendingChange=!0,this._populateAAAlarmData(e.rows,!0)):this._populateAlarmData(e.rows,!0)):void setTimeout(this.queryResults.bind(this),1)}},{key:"_populateAlarmData",value:function(e,t){var a=this;t&&(this._alarmData.length=0),e.forEach(function(e,t){var r={_notSortedRowIndex:t,_internalAlarmIdentifier:"",_internalEventTime:""},i=null,o=null,n="",l="",s=null,c=null,d=null,h=null,u=!1;e.forEach(function(e,t){var m=t;if(u&&(a._type!=a.enumAlarmType.EVENT?m-=1:m+=1),s)return o=parseInt(e.value),void(s=!1);if(a._columns[m]&&"internalEmptyColumn"!=a._columns[m].field){var _=a._columns[m].field;switch(_){case"ackReq":e.value.length>0&&(r.ackReq=e.value);break;case"state":if(u=!0,a._type!=a.enumAlarmType.EVENT)return s=!0,void(i=parseInt(e.value));_=a._columns[m+1].field;break;case"groupDescription":var p=e.value;if(p.length>0&&(isNaN(p)&&-1!=e.value.indexOf("Group")&&(p=e.value.replace("Group","")),p=p.trim(),!isNaN(p))){for(;p.length<3;)p="0"+p;p="Group "+p}r.groupDescription=p;break;case"type":if(isNaN(e.value))r.type=e.value;else{var g=parseInt(e.value);switch(parseInt(a._type)){case a.enumAlarmType.ONLINE:a._parseAlarmOnlineType(g,r);break;case a.enumAlarmType.HISTORY:a._parseAlarmHistoryType(g,r);break;case a.enumAlarmType.HISTORY_EVENT:
r.type="";break;case a.enumAlarmType.EVENT:a._parseEventType(g,r);break;default:r.type=""}}break;case"ackTime":c=!0,n=e.value,r.ackTime=n;break;case"normTime":d=!0,l=e.value,r.normTime=l;break;case"eventTime":h=!0,r.eventTime=e.value,r._internalEventTime=e.value;break;case"internalEmptyColumn":break;case"expression":"$"==e.value.charAt(0)?r[_]=e.value.replace("$",""):r[_]=e.value;break;default:r[_]=e.value}}else if(a._type!=a.enumAlarmType.EVENT){if(null==s)return s=!0,void(i=parseInt(e.value));if(null==c)return c=!0,void(n=e.value);if(null==d)return d=!0,void(e.value.length>0&&(l=e.value));if(null==h)return h=!0,void(r._internalEventTime=e.value);if(a._type==a.enumAlarmType.HISTORY_EVENT&&!e.value.match(/^\d{1,}\|\d{1,}\|\d{1,}\|\d{1,}:?.*$/))return;r._internalAlarmIdentifier=e.value}}),""!=r._internalAlarmIdentifier&&a._type!=a.enumAlarmType.EVENT?(a._alarmState[t]=a._setAlarmState(i,o),"UNACK"==a._alarmState[t]?a._alarmStateColor[t]="UNACK":"UNACK_NORM"==a._alarmState[t]?a._alarmStateColor[t]="NORM":"ACK"==a._alarmState[t]?a._alarmStateColor[t]="ACK":a._alarmStateColor[t]=a._setAlarmStateColor(n,l),a._showAlarmState&&(r.state=a._alarmState[t])):(a._alarmState[t]="EVENT",a._alarmStateColor[t]="EVENT"),a._alarmData.push(r)}),cwidget.TotalItems=this._alarmData.length,null!=this._sorted_field&&this.columns.validateColunm(this._sorted_field)&&this._doSort(this._sorted_field,this._sorted_field_desc),this._executeUpdateAlarmData()}},{key:"_populateAAAlarmData",value:function(e,t){var a=this;t&&(this._alarmData.length=0),e.forEach(function(e,t){var r={_notSortedRowIndex:t,_internalAlarmIdentifier:"",_internalEventTime:""};e.forEach(function(e,i){var o=i;if(a._columns[o]&&"internalEmptyColumn"!=a._columns[o].field){var n=a._columns[o].field;switch(n){case"AckReq":e.value.length>0&&(r.ackReq=e.value);break;case"active":a._type!=a.enumAlarmType.EVENT&&(r[n]=e.value,a._alarmState[t]=e.value.toUpperCase()),r.state=e.value;break;case"GroupDescription":var l=e.value;if(l.length>0&&(isNaN(l)&&-1!=e.value.indexOf("Group")&&(l=e.value.replace("Group","")),l=l.trim(),!isNaN(l))){for(;l.length<3;)l="0"+l;l="Group "+l}r.groupDescription=l;break;case"type":if(isNaN(e.value))r.type=e.value;else{var s=parseInt(e.value);switch(parseInt(a._type)){case a.enumAlarmType.ONLINE:a._parseAlarmOnlineType(s,r);break;case a.enumAlarmType.HISTORY:a._parseAlarmHistoryType(s,r);break;case a.enumAlarmType.HISTORY_EVENT:r.type="";break;case a.enumAlarmType.EVENT:a._parseEventType(s,r);break;default:r.type=""}}break;case"AckTime":r.ackTime=e.value;break;case"NormTime":r.normTime=e.value;break;case"EventTime":r.eventTime=e.value,r._internalEventTime=e.value;break;case"internalEmptyColumn":break;case"Expression":"$"==e.value.charAt(0)?r[n]=e.value.replace("$",""):r[n]=e.value;break;default:r[n]=e.value}}}),r.state?"UNACK_RTN"==r.state||"ACK_RTN"==r.state?a._alarmStateColor[t]="ALARM_RTN":"SHELVE_ACK"==r.state||"SHELVE_UNACK"==r.state||"SHELVE_ACK_RTN"==r.state||"SHELVE_UNACK_RTN"==r.state?a._alarmStateColor[t]="SHELVE":"ACK"==r.state?parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLoLo)?a._alarmStateColor[t]="ACK_LOLO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLo)?a._alarmStateColor[t]="ACK_LO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityHi)?a._alarmStateColor[t]="ACK_HI":a._alarmStateColor[t]="ACK_HIHI":"UNACK"==r.state&&1==parseInt(cwidget.FlashUnackAlarms)?parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLoLo)?a._alarmStateColor[t]="FLASHUNACK_LOLO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLo)?a._alarmStateColor[t]="FLASHUNACK_LO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityHi)?a._alarmStateColor[t]="FLASHUNACK_HI":a._alarmStateColor[t]="FLASHUNACK_HIHI":"UNACK"==r.state?parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLoLo)?a._alarmStateColor[t]="UNACK_LOLO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityLo)?a._alarmStateColor[t]="UNACK_LO":parseInt(r.priority)>=parseInt(cwidget.AckColorFromPriorityHi)?a._alarmStateColor[t]="UNACK_HI":a._alarmStateColor[t]="UNACK_HIHI":a._alarmStateColor[t]=r.type?r.state+"_"+r.type:r.state:(a._alarmState[t]="EVENT",a._alarmStateColor[t]="EVENT"),e.length>1&&(r._internalAlarmIdentifier=e[e.length-1].value),a._alarmData.push(r)}),cwidget.TotalItems=this._alarmData.length,null!=this._sorted_field&&this._doSort(this._sorted_field,this._sorted_field_desc),this._isInitial&&(this._executeUpdateAlarmData(),this._executeUpdateAlarm()),cwidget.TotalItems&&cwidget.TotalItems>0?this._populateAAAlarmToolbar():this._removeAAAlarmToolbar(),this._selectedRows=[],this._lastSelection=null}},{key:"_populateAAAlarmToolbar",value:function(){var e=this;if(!($(".toolbar").length>0)){var t=$('<div class="toolbar"/>').insertBefore("#alarm"),a=$('<div class="toolitem"> <svg xmlns="http://www.w3.org/2000/svg" style="height:50px; width:50px;" version="1.1"><path d="M10.54,14.53L8.41,12.4L7.35,13.46L10.53,16.64L16.53,10.64L15.47,9.58L10.54,14.53M12,20A7,7 0 0,1 5,13A7,7 0 0,1 12,6A7,7 0 0,1 19,13A7,7 0 0,1 12,20M12,4A9,9 0 0,0 3,13A9,9 0 0,0 12,22A9,9 0 0,0 21,13A9,9 0 0,0 12,4M7.88,3.39L6.6,1.86L2,5.71L3.29,7.24L7.88,3.39M22,5.72L17.4,1.86L16.11,3.39L20.71,7.25L22,5.72Z" fill="black" width="375px" height="270px" x="1px" y="1px" style="stroke-dasharray: 0; stroke-width: 1; stroke: rgb(0, 0, 0); transform: scale(2, 2); vector-effect: non-scaling-stroke;"></path></svg> <div>Ack Selected</div></div>').appendTo(t);a.on("click",function(t){e._selectedRows&&e._selectedRows.length>0&&(e._selectedToolItem=e.EnumToolItem.AckSelected,e.showInput("Ack Comment:",!1,!1,"Alarm comments are mandatory."))});var r=$('<div class="toolitem"> <svg xmlns="http://www.w3.org/2000/svg" style="height:50px; width:50px;" version="1.1"><path d="M14,2A8,8 0 0,0 6,10A8,8 0 0,0 14,18A8,8 0 0,0 22,10H20C20,13.32 17.32,16 14,16A6,6 0 0,1 8,10A6,6 0 0,1 14,4C14.43,4 14.86,4.05 15.27,4.14L16.88,2.54C15.96,2.18 15,2 14,2M20.59,3.58L14,10.17L11.62,7.79L10.21,9.21L14,13L22,5M4.93,5.82C3.08,7.34 2,9.61 2,12A8,8 0 0,0 10,20C10.64,20 11.27,19.92 11.88,19.77C10.12,19.38 8.5,18.5 7.17,17.29C5.22,16.25 4,14.21 4,12C4,11.7 4.03,11.41 4.07,11.11C4.03,10.74 4,10.37 4,10C4,8.56 4.32,7.13 4.93,5.82Z" fill="black"  x="1px" y="1px" style="stroke-dasharray: 0; stroke-width: 1; stroke: rgb(0, 0, 0); transform: scale(2, 2); vector-effect: non-scaling-stroke;"></path></svg> <div>Ack All</div></div>').appendTo(t);r.on("click",function(t){e._selectedToolItem=e.EnumToolItem.AckAll,e.showInput("Ack Comment:",!1,!1,"Alarm comments are mandatory.")});var i=parseFloat($("#alarm").css("height")),o=parseFloat($(".toolitem").css("height"));0==o&&(o=75),isNaN(i)||isNaN(o)||$("#alarm").css("height",i-o+"px")}}},{key:"_removeAAAlarmToolbar",value:function(){var e=parseFloat($("#alarm").css("height")),t=parseFloat($(".toolitem").css("height"));isNaN(e)||isNaN(t)||$("#alarm").css("height",e+t+"px"),$(".toolbar").remove()}},{key:"_parseAlarmOnlineType",value:function(e,t){switch(e){case 0:t.type="HiHi";break;case 1:t.type="Hi";break;case 2:t.type="Lo";break;case 3:t.type="LoLo";break;case 4:t.type="Change";break;case 5:t.type="Deviation+";break;case 6:t.type="Deviation-";break;default:t.type=""}}},{key:"_parseAlarmHistoryType",value:function(e,t){switch(e){case 1:t.type="HiHi";break;case 2:t.type="Hi";break;case 4:t.type="Lo";break;case 8:t.type="LoLo";break;case 16:t.type="Change";break;case 32:t.type="Deviation+";break;case 64:t.type="Deviation-";break;default:t.type=""}}},{key:"_parseEventType",value:function(e,t){switch(e){case 1:t.type="Security System";break;case 2:t.type="Display";break;case 3:t.type="Recipe";break;case 4:t.type="Report";break;case 5:t.type="Custom Messages";break;case 6:t.type="System Warning";break;case 7:t.type="Tags Change";break;case 8:t.type="Database";break;default:t.type=""}}},{key:"_setAlarmState",value:function(e,t){var a="";return e&&t&&(a="UNACK"),e&&!t&&(a="UNACK_NORM"),!e&&t&&(a="ACK"),e||t||(a="ACK_NORM"),a}},{key:"_setAlarmStateColor",value:function(e,t){var a="UNACK";if(e.length<=0&&t.length<=0)return a;if(e.length<=0)return"NORM";if(t.length<=0)return"ACK";var r=this._parseDate(e),i=this._parseDate(t);return r||i?r?i?a=r>=i?"ACK":"NORM":"ACK":"NORM":a}},{key:"_updateFirstRowValues",value:function(){var e=this,t=this._dgrid.row(0);if(!t.data)return null;var a=t.data;return this._columns.forEach(function(t,r){var i=null;if(t.field&&"internalEmptyColumn"!=t.field&&(i=a[t.field],void 0!==i))if(e.isDateTimeColumn(t.field)){var o="local_only"==e._timeZoneType&&e._type!=e.enumAlarmType.ONLINE?!1:!0,n=e._helper.strToDateTime(i,o,!0);e._firstRowValues[r]=e._parseDateTime(n)}else"ackReq"==t.field?e._firstRowValues[r]=i?"1":"0":e._firstRowValues[r]=i}),this._firstRowValues}},{key:"type",value:function(){this._type=cwidget.Type}},{key:"showHeader",value:function(){this._dgrid.set("showHeader",parseInt(cwidget.ShowHeader))}},{key:"eSign",value:function(){cwidget.host.widget.esign=parseInt(cwidget.ESign)}},{key:"showGridLines",value:function(){this._showGridLines=parseInt(cwidget.ShowGridLines)}},{key:"showAlarmState",value:function(){this._showAlarmState=parseInt(cwidget.ShowAlarmState)}},{key:"timeZoneType",value:function(){this._timeZoneType=cwidget.TimeZoneType}},{key:"_setActive",value:function(e,t){e.data&&(this._alarmState[e.data._notSortedRowIndex]="UNACK",this._alarmStateColor[e.data._notSortedRowIndex]="UNACK",t&&this._setActiveColor(e))}},{key:"_setActiveColor",value:function(e){var t=$(e.element);t.addClass("alarm-active"),this._applyGroupColor(e)}},{key:"_setNormalized",value:function(e,t){e.data&&"UNACK_NORM"!=this._alarmState[e.data._notSortedRowIndex]&&"ACK_NORM"!=this._alarmState[e.data._notSortedRowIndex]&&("UNACK"==this._alarmState[e.data._notSortedRowIndex]?this._alarmState[e.data._notSortedRowIndex]="UNACK_NORM":this._alarmState[e.data._notSortedRowIndex]="ACK_NORM",this._alarmStateColor[e.data._notSortedRowIndex]="NORM",t&&this._setNormColor(e))}},{key:"_setNormColor",value:function(e){var t=$(e.element);t.removeClass("alarm-ack"),"ACK_NORM"==this._alarmState[e.data._notSortedRowIndex]?(t.removeClass("alarm-normalized"),t.addClass("alarm-ack-normalized")):(t.removeClass("alarm-ack-normalized"),t.addClass("alarm-normalized")),this._applyGroupColor(e)}},{key:"_setEventColor",value:function(e){var t=$(e.element);t.addClass("alarm-event")}},{key:"_applyGroupColor",value:function(e){var t=$(e.element),a=this._getAlarmGroup(e.data._internalAlarmIdentifier),r="alarm-style-group-"+a;t.addClass(r)}},{key:"_getAlarmGroup",value:function(e){return e.split("|")[0]}},{key:"_setAck",value:function(e,t){e.data&&"ACK_NORM"!=this._alarmState[e.data._notSortedRowIndex]&&"ACK"!=this._alarmState[e.data._notSortedRowIndex]&&((this._alarmState[e.data._notSortedRowIndex]="UNACK_NORM")?this._alarmState[e.data._notSortedRowIndex]="ACK_NORM":this._alarmState[e.data._notSortedRowIndex]="ACK",this._alarmStateColor[e.data._notSortedRowIndex]="ACK",t&&this._setAckColor(e))}},{key:"_setAckColor",value:function(e){var t=$(e.element);t.addClass("alarm-ack"),this._applyGroupColor(e)}},{key:"_setAckHiHiColor",value:function(e){var t=$(e.element);t.addClass("alarm-ack-hihi")}},{key:"_setAckHiColor",value:function(e){var t=$(e.element);t.addClass("alarm-ack-hi")}},{key:"_setAckLoColor",value:function(e){var t=$(e.element);t.addClass("alarm-ack-lo")}},{key:"_setAckLoLoColor",value:function(e){var t=$(e.element);t.addClass("alarm-ack-lolo")}},{key:"_setUnAckHiHiColor",value:function(e){var t=$(e.element);t.addClass("alarm-unack-hihi")}},{key:"_setUnAckHiColor",value:function(e){var t=$(e.element);t.addClass("alarm-unack-hi")}},{key:"_setUnAckLoColor",value:function(e){var t=$(e.element);t.addClass("alarm-unack-lo")}},{key:"_setUnAckLoLoColor",value:function(e){var t=$(e.element);t.addClass("alarm-unack-lolo")}},{key:"_setFlashUnAckAlarmsColor",value:function(){var e=this,t=!0;this._flashUnackAlarmsColor=setInterval(function(){var a=t?"alarm-unack-hihi":"alarm-flashunack-hihi",r=t?"alarm-unack-hi":"alarm-flashunack-hi",i=t?"alarm-unack-lo":"alarm-flashunack-lo",o=t?"alarm-unack-lolo":"alarm-flashunack-lolo";e._alternateFlashUnackAlarmColor(a,r,i,o),t=!t},1e3)}},{key:"_alternateFlashUnackAlarmColor",value:function(e,t,a,r){this._setFlashUnackAlarmsClass(this._flashUnackAlarmHiHiRows,"alarm-unack-hihi","alarm-flashunack-hihi",e),this._setFlashUnackAlarmsClass(this._flashUnackAlarmHiRows,"alarm-unack-hi","alarm-flashunack-hi",t),this._setFlashUnackAlarmsClass(this._flashUnackAlarmLoRows,"alarm-unack-lo","alarm-flashunack-lo",a),this._setFlashUnackAlarmsClass(this._flashUnackAlarmLoLoRows,"alarm-unack-lolo","alarm-flashunack-lolo",r)}},{key:"_setFlashUnackAlarmsClass",value:function(e,t,a,r){for(var i=0;i<e.length;++i){var o=$(e[i].element);o.hasClass(t)&&o.removeClass(t),o.hasClass(a)&&o.removeClass(a),o.addClass(r)}}},{key:"_setAlarmRTNColor",value:function(e){var t=$(e.element);t.addClass("alarm-rtn")}},{key:"_setShelveColor",value:function(e){var t=$(e.element);t.addClass("alarm-shelve")}},{key:"_performAck",value:function(e){this._isAlarmAck(e.data._notSortedRowIndex)||(this._ackRow=e,this._ackRequireConfirmation?this.showMessageBox("Mobile Access","Confirm 'Acknowledge'?",32,4):this._ackComment?this.showInput("Comment:",!1,2==this._ackComment,"Alarm comments are mandatory."):this._endAck(e,""))}},{key:"_removeActive",value:function(e){$(e.element).removeClass("alarm-active")}},{key:"_removeNormalized",value:function(e){$(e.element).removeClass("alarm-normalized")}},{key:"_removeAck",value:function(e){$(e.element).removeClass("alarm-ack")}},{key:"_resultCallBackAfterAckAlarm",value:function(e,t){"function"==typeof t&&t(),this._setAck(e,!0),this._resultCallBackAfterCloseWindow()}},{key:"_endAck",value:function(e,t){var a=[];a[0]=e.data._internalAlarmIdentifier,0===cwidget.host.widget.esign?this._setAck(e,!0):this._resultCallBackAfteCheckESign=this._resultCallBackAfterAckAlarm.bind(this,e,cwidget._proxy.esign.closeWindow),this.ackAlarm(a,t)}},{key:"_endAckAll",value:function(){for(var e=[],t=this._alarmData.length,a=0;t>a;++a){var r=this._dgrid.row(a);this._isAlarmAck(r._notSortedRowIndex)||(e.push(r.data._internalAlarmIdentifier),this._setAck(r,!0))}this.ackAlarm(e,"")}},{key:"_endAckAAAlarm",value:function(e,t){this.ackAlarm(e,t)}},{key:"_resultCallBackAfterCloseWindow",value:function(){this._ackRow=-1}},{key:"onCloseWindow",value:function(e){var t="",a=[];switch(this._windowResult=e,this._hasOpenWindow=!1,this._openWindowType){case cwidget.enumWindowType.INPUT:if(cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA){t=e;for(var r=0;r<t.length;++r)a[r]=t.charCodeAt(r).toString(16);switch(this._selectedToolItem){case this.EnumToolItem.AckSelected:for(var i=[],o=this._selectedRows.length,n=0;o>n;++n){var l=this._selectedRows[n].data._internalAlarmIdentifier;null!=l&&i.push(l)}this._endAckAAAlarm(i,a);break;case this.EnumToolItem.AckAll:for(var i=[],o=this._alarmData.length,s=0;o>s;++s){var c=this._alarmData[s]._internalAlarmIdentifier;null!=c&&i.push(c)}this._endAckAAAlarm(i,a)}this._selectedToolItem=-1}else if(-1!=this._ackRow){t=e;for(var d=0;d<t.length;++d)a[d]=t.charCodeAt(d).toString(16);cwidget._proxy.esign.is_click=!0,this._endAck(this._ackRow,a),0===cwidget.host.widget.esign&&this._resultCallBackAfterCloseWindow()}break;case cwidget.enumWindowType.MSGBOX:if(6!=e.output.ReturnValue)return void(this._isAckAll=!1);if(this._isAckAll)return this._isAckAll=!1,void this._endAckAll();this._ackRequireConfirmation&&(cwidget._proxy.esign.is_click=!0,this._endAck(this._ackRow,"")),this._ackComment&&this.showInput("Comment:",!1,2==this._ackComment,"Alarm comments are mandatory.")}}},{key:"hasOpenWindow",value:function(){return this._hasOpenWindow}},{key:"setOpenWindow",value:function(e){this._openWindowType=e,this._hasOpenWindow=!0}},{key:"_parseDateTime",value:function(e){var t=[],a=[],r=[],i=[],o="",n="000";if(r=e.split(" "),2!=r.length)return"";if(a=r[0].split("/"),3!=a.length)return"";if(t=r[1].split(":"),3!=t.length)return"";if(i=t[2].split("."),parseInt(cwidget.Month)&&(o+=a[0]),parseInt(cwidget.Day)&&(""!=o&&(o+="/"),o+=a[1]),parseInt(cwidget.Year)&&(""!=o&&(o+="/"),o+=a[2]),""!=o&&(o+=" "),parseInt(cwidget.Hour)&&(o+=t[0]),parseInt(cwidget.Minute)&&(parseInt(cwidget.Hour)&&(o+=":"),o+=t[1]),parseInt(cwidget.Second)&&((parseInt(cwidget.Hour)||parseInt(cwidget.Minute))&&(o+=":"),o+=i[0]),parseInt(cwidget.MS)){for((parseInt(cwidget.Hour)||parseInt(cwidget.Minute)||parseInt(cwidget.Second))&&(o+="."),2==i.length&&(n=i[1]);n.length<3;)n="0"+n;o+=n}return o}},{key:"_onShow",value:function(){if(cwidget._proxy.host.widget.params._attr.engine==this.EnumRuntimeScadaEngine.ArchestrA){var e=1e3;"undefined"!=typeof cwidget.host.win.alarmPullingRate&&null!=cwidget.host.win.alarmPullingRate&&cwidget.host.win.alarmPullingRate>0&&(e=cwidget.host.win.alarmPullingRate),this._interval=setInterval(this._executeUpdateAlarmData.bind(this),e)}}},{key:"_onHide",value:function(){cwidget.Engine==this.EnumRuntimeScadaEngine.ArchestrA&&this._interval&&(clearInterval(this._interval),this._interval=null)}},{key:"_initSort",value:function(){try{if(!cwidget.SortInfoField||!cwidget.SortInfoAscending)return setTimeout(this._initSort.bind(this),100)}catch(e){return setTimeout(this._initSort.bind(this),100)}if(0==cwidget.SortInfoField.length)return setTimeout(this._initSort.bind(this),100);var t=[],a=[];if(cwidget.SortInfoField.forEach(function(e){t.push(e)}),cwidget.SortInfoAscending.forEach(function(e){a.push("1"===e?!1:!0)}),t.length>0){this._sorted_field=t,this._sorted_field_desc=a,this._doSort(t,a),this._executeUpdateAlarmData();var r={property:t[0],descending:a[0]};this._dgrid.updateSortArrow(new Array(r),!0),this._executeUpdateAlarm(),"ackReq"==this._sorted_field&&$(".dgrid-sort-arrow").css("display","none")}}}]),e}();window.__debug&&window.__debug(),new l(dojo.require("dgrid/Grid"),dojo.require("dgrid/util/touch"))},{"./CellRender":1,"./Columns":2}]},{},[3]);
//# sourceMappingURL=Z:/.helpers/tasks/../../dailybuilds/alarm/alarm/build/build.min.js.map